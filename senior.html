<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sushruta | Ancient Wisdom, Modern Care</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary: #1E3A8A; /* Deep Medical Blue */
            --accent: #D4AF37; /* Gold from Logo */
            --bg-gradient-start: #F0F4F8;
            --bg-gradient-end: #D9E2EC;
        }

        body { 
            font-family: 'Outfit', sans-serif; 
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            color: #1A202C;
            min-height: 100vh;
        }

        /* --- ANIMATIONS --- */
        .fade-in { animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .slide-up { animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #CBD5E0; border-radius: 4px; }
        
        /* --- GLASS EFFECT --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 4px; }
        
        .image-container:hover .overlay { opacity: 1; }
        .overlay { opacity: 0; transition: .3s ease; }

        /* --- FORM ELEMENTS --- */
        .no-spinner::-webkit-inner-spin-button, 
        .no-spinner::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        .no-spinner { -moz-appearance: textfield; }

        .form-label { 
            display: block; 
            font-size: 0.7rem; 
            font-weight: 700; 
            color: #64748B; 
            margin-bottom: 0.35rem; 
            text-transform: uppercase; 
            letter-spacing: 0.05em; 
        }
        .form-input { 
            width: 100%; 
            padding: 0.6rem 0.8rem; 
            border: 1px solid #E2E8F0; 
            border-radius: 0.5rem; 
            outline: none; 
            font-size: 0.95rem; 
            transition: all 0.2s; 
            background-color: #fff; 
        }
        .form-input:focus { border-color: #0F766E; ring: 2px solid #0F766E; }
        .form-input:disabled { background-color: #F8FAFC; color: #475569; border-color: #F1F5F9; cursor: not-allowed; }

        /* --- DASHBOARD SPECIFICS --- */
        .vital-card { transition: all 0.3s ease; cursor: pointer; }
        .vital-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .pulse-ring { animation: pulse-ring 2s infinite; }
        @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        
        /* --- NAVIGATION --- */
        .nav-item.active { color: #1E3A8A; }
        .nav-item.active i { font-weight: bold; }
        
        /* --- YOGA CARD --- */
        .yoga-card:hover .play-btn { opacity: 1; transform: scale(1); }

        /* --- CHAT BOT --- */
        .chat-bubble { max-width: 80%; padding: 12px 16px; border-radius: 16px; position: relative; margin-bottom: 8px; animation: slideUp 0.3s ease; }
        .chat-user { background: #1E3A8A; color: white; border-bottom-right-radius: 4px; align-self: flex-end; margin-left: auto; }
        .chat-bot { background: #F1F5F9; color: #1E293B; border-bottom-left-radius: 4px; align-self: flex-start; margin-right: auto; border: 1px solid #E2E8F0; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; height: 6px; width: 6px; background: #94A3B8; border-radius: 50%; display: inline-block; margin: 0 2px; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* --- HEALTH SCORE CIRCLE UI --- */
        .circular-chart { display: block; margin: 0 auto; max-width: 100%; max-height: 250px; }
        .circle-bg { fill: none; stroke: #e2e8f0; stroke-width: 2.5; }
        .circle { fill: none; stroke-width: 2.5; stroke-linecap: round; animation: progress 1s ease-out forwards; transition: stroke-dasharray 0.5s ease; }
        .percentage { fill: #1e3a8a; font-family: 'Outfit', sans-serif; font-weight: 800; font-size: 0.6em; text-anchor: middle; }
        .mini-graph { fill: none; stroke: #1E3A8A; stroke-width: 0.5; opacity: 0.3; stroke-linecap: round; stroke-linejoin: round; }
        @keyframes progress { 0% { stroke-dasharray: 0 100; } }

        /* SOS Animation */
        .sos-pulse { animation: sosPulse 2s infinite; }
        @keyframes sosPulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const LOGO_SRC = "https://image2url.com/images/1765805243191-d5f3a19d-770b-41d8-94c1-33d7216f45f0.png";

        // --- MOCK DATABASE (LOCAL STORAGE WRAPPER) ---
        const DB = {
            save: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
            get: (key) => JSON.parse(localStorage.getItem(key)) || null,
            init: () => {
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify([]));
                }
            }
        };
        DB.init();

        // --- TOAST NOTIFICATION COMPONENT ---
        const Toast = ({ msg, type }) => {
            if (!msg) return null;
            const colors = type === 'error' ? 'bg-red-500' : 'bg-emerald-600';
            return (
                <div className={`fixed top-6 right-6 ${colors} text-white px-6 py-4 rounded-xl shadow-2xl z-[70] fade-in flex items-center gap-3 border border-white/20`}>
                    <i className={type === 'error' ? "ph-bold ph-warning-circle text-xl" : "ph-bold ph-check-circle text-xl"}></i>
                    <span className="font-medium">{msg}</span>
                </div>
            );
        };

        // --- AUTH COMPONENT (LOGIN/SIGNUP) ---
        const Auth = ({ onLogin }) => {
            const [view, setView] = useState('login'); 
            const [role, setRole] = useState('senior');
            const [formData, setFormData] = useState({});
            const [loading, setLoading] = useState(false);
            const [toast, setToast] = useState(null);
            const [otp, setOtp] = useState('');
            const [genOtp, setGenOtp] = useState(null);

            const AUTH_BG_IMAGE = "https://image2url.com/images/1765813364304-04cd83c9-8e5b-410b-a5d0-f4d31263c553.jpg";

            const showToast = (msg, type) => {
                setToast({ msg, type });
                setTimeout(() => setToast(null), 3000);
            };

            const handleInputChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const renderFormFields = () => {
                switch(role) {
                    case 'senior':
                        return (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 slide-up">
                                <input name="name" placeholder="Full Name" className="p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-900 outline-none col-span-2" onChange={handleInputChange} required />
                                <input name="dob" type="date" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                                <select name="gender" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange}>
                                    <option value="">Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                                <input name="phone" type="tel" placeholder="Mobile Number" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                                <select name="bloodGroup" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange}>
                                    <option value="">Blood Group</option>
                                    <option value="A+">A+</option><option value="A-">A-</option><option value="B+">B+</option><option value="B-">B-</option><option value="O+">O+</option><option value="O-">O-</option>
                                </select>
                                <textarea name="address" placeholder="Address (City / Area)" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none col-span-2" rows="2" onChange={handleInputChange}></textarea>
                                <div className="col-span-2 bg-red-50 p-3 rounded-lg border border-red-100">
                                    <h4 className="text-red-800 text-sm font-bold mb-2">Emergency Contact</h4>
                                    <div className="grid grid-cols-2 gap-2">
                                        <input name="emergencyName" placeholder="Contact Name" className="p-2 bg-white border border-red-200 rounded outline-none" onChange={handleInputChange} />
                                        <input name="emergencyPhone" placeholder="Contact Phone" className="p-2 bg-white border border-red-200 rounded outline-none" onChange={handleInputChange} />
                                    </div>
                                </div>
                                <input name="pin" type="password" placeholder="Set 4-Digit PIN" maxLength="4" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none col-span-2" onChange={handleInputChange} required />
                            </div>
                        );
                    case 'caretaker':
                        return (
                            <div className="grid grid-cols-1 gap-4 slide-up">
                                <input name="name" placeholder="Full Name" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                                <select name="relation" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange}>
                                    <option value="">Relation to Senior</option>
                                    <option value="Son">Son</option>
                                    <option value="Daughter">Daughter</option>
                                    <option value="Professional Nurse">Professional Nurse</option>
                                    <option value="Other">Other</option>
                                </select>
                                <input name="phone" type="tel" placeholder="Mobile Number" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                                <input name="email" type="email" placeholder="Email (Optional)" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} />
                                <input name="address" placeholder="Address (City)" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} />
                                <input name="pin" type="password" placeholder="Set 4-Digit PIN" maxLength="4" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                            </div>
                        );
                    case 'doctor':
                        return (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 slide-up">
                                <input name="name" placeholder="Dr. Full Name" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none col-span-2" onChange={handleInputChange} required />
                                <select name="specialization" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange}>
                                    <option value="">Specialization</option>
                                    <option value="Cardiologist">Cardiologist</option>
                                    <option value="General Physician">General Physician</option>
                                    <option value="Orthopedic">Orthopedic</option>
                                    <option value="Neurologist">Neurologist</option>
                                </select>
                                <input name="regNo" placeholder="Medical Reg. No." className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                                <input name="clinic" placeholder="Hospital / Clinic Name" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none col-span-2" onChange={handleInputChange} required />
                                <input name="city" placeholder="City" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                                <input name="phone" type="tel" placeholder="Contact Number" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none" onChange={handleInputChange} required />
                                <div className="col-span-2 p-3 bg-slate-50 rounded-lg border border-slate-200">
                                    <label className="text-sm text-slate-500 block mb-2">Consultation Mode</label>
                                    <div className="flex gap-4">
                                        <label className="flex items-center gap-2"><input type="radio" name="mode" value="Online" onChange={handleInputChange} /> Online</label>
                                        <label className="flex items-center gap-2"><input type="radio" name="mode" value="Offline" onChange={handleInputChange} /> Offline</label>
                                        <label className="flex items-center gap-2"><input type="radio" name="mode" value="Both" onChange={handleInputChange} /> Both</label>
                                    </div>
                                </div>
                                <input name="pin" type="password" placeholder="Set 4-Digit PIN" maxLength="4" className="p-3 bg-slate-50 border border-slate-200 rounded-lg outline-none col-span-2" onChange={handleInputChange} required />
                            </div>
                        );
                    default: return null;
                }
            };

            const handleLogin = (e) => {
                e.preventDefault();
                setLoading(true);
                setTimeout(() => {
                    const users = DB.get('users');
                    const user = users.find(u => u.phone === formData.loginPhone && u.pin === formData.loginPin);
                    if (user) {
                        showToast(`Welcome back, ${user.name}`, 'success');
                        setTimeout(() => onLogin(user), 1500);
                    } else {
                        showToast('Invalid Credentials', 'error');
                        setLoading(false);
                    }
                }, 1500);
            };

            const triggerOtp = (e) => {
                e.preventDefault();
                if(!formData.name || !formData.phone || !formData.pin) return showToast('Please fill required fields', 'error');
                
                setLoading(true);
                const code = Math.floor(1000 + Math.random() * 9000);
                setGenOtp(code);
                
                setTimeout(() => {
                    alert(`ðŸ” SUSHRUTA OTP: ${code}`);
                    setLoading(false);
                    setView('otp');
                }, 1500);
            };

            const verifyOtp = (e) => {
                e.preventDefault();
                if(parseInt(otp) === genOtp) {
                    const users = DB.get('users');
                    const newUser = { ...formData, role: role, meds: [] }; 
                    users.push(newUser);
                    DB.save('users', users);
                    showToast('Registration Successful!', 'success');
                    setView('login');
                } else {
                    showToast('Invalid OTP', 'error');
                }
            };

            return (
                <div 
                    className="min-h-screen flex items-center justify-center p-4 bg-cover bg-center bg-no-repeat"
                    style={{ 
                        backgroundImage: `url('${AUTH_BG_IMAGE}')`,
                        backgroundColor: 'rgba(0,0,0,0.4)', 
                        backgroundBlendMode: 'overlay'
                    }}
                >
                    <Toast msg={toast?.msg} type={toast?.type} />

                    <div className="w-full max-w-5xl bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[600px] glass-card">
                        
                        {/* LEFT SIDE: Visuals & Branding */}
                        <div className="md:w-5/12 bg-gradient-to-br from-blue-900 to-blue-700 p-12 text-white flex flex-col justify-between relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full transform translate-x-1/2 -translate-y-1/2"></div>
                            <div className="absolute bottom-0 left-0 w-40 h-40 bg-yellow-400 opacity-10 rounded-full transform -translate-x-1/2 translate-y-1/2"></div>
                            
                            <div className="z-10 text-center md:text-left">
                                <div className="logo-container mb-6 flex justify-center ">
                                    <img 
                                        src={LOGO_SRC} 
                                        alt="Sushruta Logo" 
                                        className="w-32 h-32 rounded-full object-cover mb-4 border-4 border-white/20 bg-white shadow-lg"
                                        onError={(e) => {
                                            e.target.style.display = 'none'; 
                                            e.target.parentElement.innerHTML = '<div class="w-32 h-32 bg-white rounded-full flex items-center justify-center text-blue-900 font-bold text-4xl border-4 border-white/20 shadow-lg">S</div>';
                                        }} 
                                    />
                                </div>
                                <h1 className="text-4xl font-bold mb-2 text-center">SUSHRUTA</h1>
                                <p className="text-blue-100 font-light tracking-wide text-center">Ancient Wisdom, Modern Care.</p>
                            </div>

                            <div className="z-10 mt-8 space-y-4 hidden md:block">
                                <div className="flex items-center gap-3">
                                    <i className="ph-fill ph-shield-check text-2xl text-yellow-400"></i>
                                    <span className="text-sm opacity-90">Secure Health Data</span>
                                </div>
                                <div className="flex items-center gap-3">
                                    <i className="ph-fill ph-heartbeat text-2xl text-yellow-400"></i>
                                    <span className="text-sm opacity-90">Real-time Vitals Monitoring</span>
                                </div>
                                <div className="flex items-center gap-3">
                                    <i className="ph-fill ph-users-three text-2xl text-yellow-400"></i>
                                    <span className="text-sm opacity-90">Community & Doctor Connect</span>
                                </div>
                            </div>
                        </div>

                        {/* RIGHT SIDE: Dynamic Forms */}
                        <div className="md:w-7/12 p-8 md:p-12 bg-white flex flex-col justify-center">
                            
                            {/* VIEW: LOGIN */}
                            {view === 'login' && (
                                <div className="fade-in max-w-sm mx-auto w-full">
                                    <h2 className="text-3xl font-bold text-blue-900 mb-2">Welcome Back</h2>
                                    <p className="text-slate-500 mb-8">Access your health dashboard</p>
                                    <form onSubmit={handleLogin} className="space-y-4">
                                        <div className="relative">
                                            <i className="ph-bold ph-phone absolute left-3 top-3.5 text-slate-400"></i>
                                            <input name="loginPhone" type="tel" placeholder="Mobile Number" className="w-full pl-10 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-900 outline-none" onChange={handleInputChange} required />
                                        </div>
                                        <div className="relative">
                                            <i className="ph-bold ph-lock-key absolute left-3 top-3.5 text-slate-400"></i>
                                            <input name="loginPin" type="password" placeholder="4-Digit PIN" className="w-full pl-10 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-900 outline-none" onChange={handleInputChange} required />
                                        </div>
                                        <button disabled={loading} className="w-full bg-blue-900 text-white py-3 rounded-xl font-semibold shadow-lg hover:bg-blue-800 transition flex justify-center">
                                            {loading ? <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-white"></div> : 'Login'}
                                        </button>
                                    </form>
                                    <p className="text-center mt-6 text-slate-500">
                                        New to Sushruta? <button onClick={() => setView('role-select')} className="text-blue-900 font-bold hover:underline">Create Account</button>
                                    </p>
                                </div>
                            )}

                            {/* VIEW: ROLE SELECTION */}
                            {view === 'role-select' && (
                                <div className="fade-in">
                                    <button onClick={() => setView('login')} className="mb-4 text-slate-400 hover:text-blue-900 flex items-center gap-1"><i className="ph-bold ph-arrow-left"></i> Back</button>
                                    <h2 className="text-2xl font-bold text-blue-900 mb-6">Choose your Profile</h2>
                                    <div className="grid gap-4">
                                        <button onClick={() => {setRole('senior'); setView('signup-form');}} className="group flex items-center p-4 border border-slate-200 rounded-2xl hover:border-blue-900 hover:bg-blue-50 transition text-left">
                                            <div className="w-12 h-12 bg-blue-100 text-blue-900 rounded-full flex items-center justify-center text-2xl mr-4 group-hover:bg-blue-900 group-hover:text-white transition"><i className="ph-fill ph-user"></i></div>
                                            <div>
                                                <h3 className="font-bold text-lg text-slate-800">Senior Citizen</h3>
                                                <p className="text-sm text-slate-500">I want to manage my health & connect.</p>
                                            </div>
                                        </button>
                                        <button onClick={() => {setRole('caretaker'); setView('signup-form');}} className="group flex items-center p-4 border border-slate-200 rounded-2xl hover:border-green-600 hover:bg-green-50 transition text-left">
                                            <div className="w-12 h-12 bg-green-100 text-green-700 rounded-full flex items-center justify-center text-2xl mr-4 group-hover:bg-green-600 group-hover:text-white transition"><i className="ph-fill ph-heart text-red-600"></i></div>
                                            <div>
                                                <h3 className="font-bold text-lg text-slate-800">Caretaker</h3>
                                                <p className="text-sm text-slate-500">I am looking after a senior member.</p>
                                            </div>
                                        </button>
                                        <button onClick={() => {setRole('doctor'); setView('signup-form');}} className="group flex items-center p-4 border border-slate-200 rounded-2xl hover:border-purple-600 hover:bg-purple-50 transition text-left">
                                            <div className="w-12 h-12 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center text-2xl mr-4 group-hover:bg-purple-600 group-hover:text-white transition"><i className="ph-fill ph-stethoscope"></i></div>
                                            <div>
                                                <h3 className="font-bold text-lg text-slate-800">Doctor</h3>
                                                <p className="text-sm text-slate-500">I am a medical professional.</p>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* VIEW: SIGNUP FORM */}
                            {view === 'signup-form' && (
                                <div className="fade-in">
                                    <div className="flex justify-between items-center mb-6">
                                        <button onClick={() => setView('role-select')} className="text-slate-400 hover:text-blue-900"><i className="ph-bold ph-arrow-left text-xl"></i></button>
                                        <span className="text-sm font-bold uppercase tracking-wider text-blue-900 bg-blue-100 px-3 py-1 rounded-full">{role} Sign Up</span>
                                    </div>
                                    <form onSubmit={triggerOtp} className="space-y-4">
                                        {renderFormFields()}
                                        <button disabled={loading} className="w-full bg-blue-900 text-white py-3 rounded-xl font-semibold shadow-lg hover:bg-blue-800 transition mt-6 flex justify-center">
                                            {loading ? <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-white"></div> : 'Verify & Register'}
                                        </button>
                                    </form>
                                </div>
                            )}

                            {/* VIEW: OTP */}
                            {view === 'otp' && (
                                <div className="fade-in text-center max-w-sm mx-auto">
                                    <div className="w-16 h-16 bg-blue-100 text-blue-900 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                                        <i className="ph-fill ph-lock-key-open"></i>
                                    </div>
                                    <h2 className="text-2xl font-bold text-slate-800 mb-2">Verify Mobile</h2>
                                    <p className="text-slate-500 mb-6">Enter the code sent to your mobile</p>
                                    <form onSubmit={verifyOtp}>
                                        <input type="number" autoFocus className="w-full p-4 text-center text-3xl font-bold tracking-[0.5em] border-2 border-blue-200 rounded-xl focus:border-blue-900 outline-none mb-6" onChange={(e) => setOtp(e.target.value)} />
                                        <button className="w-full bg-blue-900 text-white py-3 rounded-xl font-semibold shadow-lg">Confirm Registration</button>
                                    </form>
                                </div>
                            )}

                        </div>
                    </div>
                </div>
            );
        };

        // =========================================================================================
        //  DATABASE LAYER (EMERGENCY RESET VERSION)
        // =========================================================================================
        const MockBackend = {
            // New Key
            DB_KEY: 'sushruta_db_v_final_reset', 

            initDB: () => {
                try {
                    const now = new Date();
                    const todayStr = now.toDateString(); 
                    let data = null;

                    // 1. Try to load existing data
                    try {
                        const raw = localStorage.getItem(MockBackend.DB_KEY);
                        if (raw) data = JSON.parse(raw);
                    } catch (e) {
                        localStorage.removeItem(MockBackend.DB_KEY);
                    }

                    // 2. If no data exists, create Seed Data
                    if (!data) {
                        data = {
                            lastLogin: todayStr,
                            user: { 
                                name: '', phone: '', pin: '', dob: '', gender: '', address: '', language: '', photo: '', 
                                emergencyPrimary: { name: '', contact: '', relation: 'Guardian' }, 
                                caretaker: { name: '', contact: '' },
                                doctor: { name: '', contact: '' },
                                emergencySecondary: {}, hospitalPref: '', bloodGroup: '', allergies: '', chronicConditions: '', history: '', surgeries: '', treatments: '' 
                            },
                            meds: [
                                { id: 1, name: "Metformin", type: "Tablet", category: "Daily Routine", dose: "500mg", qty: "1 Tab", stock: 15, expiry: "Dec 2025", schedule: "Morning", instructions: "After Breakfast", taken: false },
                                { id: 2, name: "Amlodipine", type: "Tablet", category: "Daily Routine", dose: "5mg", qty: "1 Tab", stock: 10, expiry: "Jan 2026", schedule: "Night", instructions: "Before Sleep", taken: false },
                            ],
                            vitals: { steps: 120, target: 5000, bp: "120/80", heartRate: 72, sleep: "6.5", exercise: false }, 
                            history: {
                                dates: [], 
                                steps: [3200, 4500, 2800, 5100, 4200, 3800], 
                                heart: [72, 75, 68, 74, 71, 70],
                                bp: [122, 118, 125, 120, 119, 121],
                                sleep: [6.5, 7.0, 5.5, 8.0, 6.2, 7.1],
                                score: [0, 0, 0, 0, 0, 86] 
                            },
                            reports: [], 
                            reminders: [],
                            appointments: [],
                            wellnessLogs: [],
                            customVideos: {} 
                        };
                        
                        // Water Reminders
                        const start = 7; const end = 23;
                        for (let h = start; h <= end; h++) {
                            const ampm = h >= 12 ? 'PM' : 'AM';
                            const hour = h % 12 || 12;
                            const timeStr = `${hour.toString().padStart(2, '0')}:00 ${ampm}`;
                            data.reminders.push({ id: `water-${h}-${Date.now()}`, text: "Drink Water", time: timeStr, day: now.getDate(), completed: false });
                        }
                        
                        // 3. EMERGENCY SAVE: If full, clear EVERYTHING and try again
                        try {
                            localStorage.setItem(MockBackend.DB_KEY, JSON.stringify(data));
                        } catch (e) {
                            console.warn("Storage Full! Performing Hard Reset...");
                            // THIS LINE FIXES YOUR PROBLEM
                            localStorage.clear(); 
                            try {
                                localStorage.setItem(MockBackend.DB_KEY, JSON.stringify(data));
                                alert("Database Reset Successfully (Old clutter removed).");
                            } catch(err2) {
                                alert("Critical Error: Browser storage is completely locked.");
                            }
                        }
                    } 
                    else {
                        // Daily Reset Logic
                        if (data.lastLogin !== todayStr) {
                            data.history.steps.shift(); data.history.steps.push(data.vitals.steps || 0);
                            data.history.heart.shift(); data.history.heart.push(data.vitals.heartRate || 70);
                            data.history.sleep.shift(); data.history.sleep.push(parseFloat(data.vitals.sleep) || 0);
                            
                            data.vitals.steps = 0; data.vitals.sleep = "0"; data.vitals.exercise = false;
                            data.reminders = data.reminders.filter(r => r.text !== "Drink Water"); 
                            const start = 7; const end = 23;
                            for (let h = start; h <= end; h++) {
                                const ampm = h >= 12 ? 'PM' : 'AM';
                                const hour = h % 12 || 12;
                                const timeStr = `${hour.toString().padStart(2, '0')}:00 ${ampm}`;
                                data.reminders.push({ id: `water-${h}-${Date.now()}`, text: "Drink Water", time: timeStr, day: now.getDate(), completed: false });
                            }
                            data.meds = data.meds.map(m => ({...m, taken: false}));
                            data.lastLogin = todayStr;
                            MockBackend.updateData(data);
                        }
                    }
                } catch (err) {
                    console.error("InitDB Error:", err);
                }
            },

            getData: () => {
                try { return JSON.parse(localStorage.getItem(MockBackend.DB_KEY)); } catch (e) { return null; }
            },

            saveUser: (user) => {
                const data = MockBackend.getData();
                if(data) {
                    data.user = { ...data.user, ...user };
                    MockBackend.updateData(data);
                }
            },

            updateData: (newData) => {
                try {
                    localStorage.setItem(MockBackend.DB_KEY, JSON.stringify(newData));
                    return true;
                } catch (e) {
                    alert("âš ï¸ STORAGE FULL! Please delete some Custom Videos or Reports.");
                    return false;
                }
            },

            getStorageSize: () => {
                let total = 0;
                for (let x in localStorage) {
                    if (localStorage.hasOwnProperty(x)) {
                        total += ((localStorage[x].length * 2) / 1024 / 1024);
                    }
                }
                return total.toFixed(2);
            }
        };
        MockBackend.initDB();

        

        // --- CHART COMPONENT ---
        const ChartModal = ({ type, history, currentVal, close }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            
            useEffect(() => {
                if (chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    
                    const labels = [];
                    for(let i=6; i>0; i--) {
                        const d = new Date();
                        d.setDate(d.getDate() - i);
                        labels.push(d.toLocaleDateString('en-US', { day: 'numeric', month: 'short' }));
                    }
                    labels.push("Today");

                    const cleanHistory = history.map(h => Number(h) || 0);
                    const finalVal = Number(currentVal) || 0;
                    const finalData = [...cleanHistory, finalVal];

                    const maxValue = Math.max(...finalData);
                    const suggestedMax = maxValue + (maxValue * 0.2); 

                    // Destroy existing chart if it exists to prevent overlap
                    if(chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: type,
                                data: finalData,
                                borderColor: type.includes('Heart') ? '#EF4444' : type.includes('Sleep') ? '#8B5CF6' : '#0F766E',
                                backgroundColor: type.includes('Heart') ? 'rgba(239, 68, 68, 0.1)' : 'rgba(15, 118, 110, 0.1)',
                                borderWidth: 3,
                                tension: 0.3, 
                                fill: true,
                                pointBackgroundColor: '#fff',
                                pointBorderWidth: 2,
                                pointRadius: 5
                            }]
                        },
                        options: { 
                            responsive: true, 
                            animation: false, 
                            plugins: { legend: { display: false } },
                            scales: { 
                                y: { 
                                    beginAtZero: true,
                                    suggestedMax: suggestedMax 
                                } 
                            }
                        }
                    });
                }
                return () => { 
                    if(chartInstance.current) {
                        chartInstance.current.destroy(); 
                        chartInstance.current = null;
                    } 
                }
            }, [type]); 

            useEffect(() => {
                if(chartInstance.current) {
                    const chart = chartInstance.current;
                    const dataArr = chart.data.datasets[0].data;
                    const newVal = Number(currentVal) || 0;
                    dataArr[dataArr.length - 1] = newVal;
                    const currentMax = chart.scales.y.max || chart.options.scales.y.suggestedMax;
                    if(newVal > currentMax) {
                        chart.options.scales.y.suggestedMax = newVal * 1.2;
                    }
                    chart.update('none'); 
                }
            }, [currentVal]);

            return (
                <div className="fixed inset-0 bg-black/50 z-[80] flex items-center justify-center p-4 fade-in">
                    <div className="bg-white rounded-2xl w-full max-w-lg p-6 relative slide-up shadow-2xl">
                        <button onClick={close} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i className="ph-bold ph-x text-xl"></i></button>
                        <h3 className="text-xl font-bold mb-4 text-slate-800">{type} History</h3>
                        <canvas ref={chartRef}></canvas>
                    </div>
                </div>
            );
        };

        // --- MANUAL ENTRY MODAL ---
        const ManualEntryModal = ({ metric, onClose, onSave }) => {
            const [val, setVal] = useState('');
            const [sys, setSys] = useState('');
            const [dia, setDia] = useState('');
            const [hrs, setHrs] = useState('');
            const [mins, setMins] = useState('');

            const isBP = metric.includes('Blood Pressure') || metric === 'BP';
            const isSleep = metric.includes('Sleep');
            const isSteps = metric.includes('Steps');
            const isHeart = metric.includes('Heart');

            const handleSave = () => {
                if (isBP) {
                    if (sys && dia) onSave(`${sys}/${dia}`);
                } else if (isSleep) {
                    if (hrs && mins) {
                        onSave({ display: `${hrs}h ${mins}m`, value: parseFloat(hrs) + parseFloat(mins)/60 });
                    }
                } else {
                    onSave(val);
                }
            };

            return (
                <div className="fixed inset-0 bg-black/60 z-[80] flex items-center justify-center p-4 fade-in backdrop-blur-sm">
                    <div className="bg-white rounded-3xl w-full max-w-sm p-8 relative slide-up shadow-2xl">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                            <i className="ph-bold ph-x text-xl"></i>
                        </button>
                        <div className="text-center mb-6">
                            <div className="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i className={`text-2xl ph-fill ${isSteps ? 'ph-sneaker-move' : isHeart ? 'ph-heartbeat' : isBP ? 'ph-drop' : 'ph-moon-stars'}`}></i>
                            </div>
                            <h3 className="text-xl font-bold text-slate-800">Update {metric}</h3>
                            <p className="text-slate-400 text-sm">Enter your latest reading</p>
                        </div>

                        {/* DYNAMIC INPUTS */}
                        <div className="mb-6">
                            {isBP ? (
                                <div className="flex items-center gap-2 justify-center">
                                    <div className="relative">
                                        <input type="number" placeholder="120" value={sys} onChange={e=>setSys(e.target.value)} className="w-20 p-3 text-center text-xl font-bold bg-slate-50 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 no-spinner" />
                                        <span className="block text-xs text-slate-400 text-center mt-1">SYS</span>
                                    </div>
                                    <span className="text-2xl text-slate-300">/</span>
                                    <div className="relative">
                                        <input type="number" placeholder="80" value={dia} onChange={e=>setDia(e.target.value)} className="w-20 p-3 text-center text-xl font-bold bg-slate-50 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 no-spinner" />
                                        <span className="block text-xs text-slate-400 text-center mt-1">DIA</span>
                                    </div>
                                    <span className="text-sm font-bold text-slate-500 ml-2">mmHg</span>
                                </div>
                            ) : isSleep ? (
                                <div className="flex items-center gap-3 justify-center">
                                    <div className="relative">
                                        <input type="number" placeholder="7" value={hrs} onChange={e=>setHrs(e.target.value)} className="w-20 p-3 text-center text-xl font-bold bg-slate-50 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 no-spinner" />
                                        <span className="absolute top-3.5 right-2 text-xs text-slate-400 font-bold">hr</span>
                                    </div>
                                    <div className="relative">
                                        <input type="number" placeholder="30" value={mins} onChange={e=>setMins(e.target.value)} className="w-20 p-3 text-center text-xl font-bold bg-slate-50 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 no-spinner" />
                                        <span className="absolute top-3.5 right-2 text-xs text-slate-400 font-bold">min</span>
                                    </div>
                                </div>
                            ) : (
                                <div className="relative">
                                    <input 
                                        type="number" 
                                        autoFocus
                                        className="w-full p-4 text-center text-2xl font-bold bg-slate-50 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 no-spinner"
                                        placeholder="0"
                                        value={val}
                                        onChange={(e) => setVal(e.target.value)}
                                    />
                                    <span className="absolute top-5 right-4 text-sm font-bold text-slate-400 uppercase">{isSteps ? 'steps' : 'bpm'}</span>
                                </div>
                            )}
                        </div>

                        <button onClick={handleSave} className="w-full py-3 bg-blue-900 text-white font-bold rounded-xl hover:bg-blue-800 shadow-lg shadow-blue-200 transition-all active:scale-95">
                            Update Data
                        </button>
                    </div>
                </div>
            );
        };

        // --- NOTIFICATION ALERT MODAL ---
        const NotificationAlert = ({ reminder, onComplete, onClose }) => {
            if (!reminder) return null;
            return (
                <div className="fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 fade-in backdrop-blur-sm">
                    <div className="bg-white rounded-3xl w-full max-w-sm p-6 relative slide-up shadow-2xl border-t-8 border-blue-500 text-center">
                        <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600">
                            <i className="ph-fill ph-alarm text-3xl animate-bounce"></i>
                        </div>
                        <h3 className="text-2xl font-bold text-slate-800 mb-1">Time for {reminder.text}!</h3>
                        <p className="text-slate-500 mb-6">It's {reminder.time}. Have you completed this task?</p>
                        
                        <div className="space-y-3">
                            <button 
                                onClick={onComplete}
                                className="w-full py-3.5 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all active:scale-95"
                            >
                                <i className="ph-bold ph-check mr-2"></i> Yes, Mark Complete
                            </button>
                            <button 
                                onClick={onClose}
                                className="w-full py-3.5 text-slate-500 font-bold hover:bg-slate-50 rounded-xl transition-all"
                            >
                                Snooze / Close
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- AI ASSISTANT TAB ---
        const AiAssistantTab = () => {
            const [messages, setMessages] = useState([
                { id: 1, sender: 'bot', text: 'Namaste! I am your health assistant. How are you feeling today?' }
            ]);
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const chatEndRef = useRef(null);

            const scrollToBottom = () => chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            useEffect(scrollToBottom, [messages, isTyping]);

            const handleSend = (e) => {
                e.preventDefault();
                if(!input.trim()) return;

                const userMsg = { id: Date.now(), sender: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setIsTyping(true);

                // Simple Mock AI Logic
                setTimeout(() => {
                    let responseText = "I see. It's best to consult your doctor for persistent symptoms.";
                    const lower = userMsg.text.toLowerCase();

                    if(lower.includes('headache') || lower.includes('head hurts')) responseText = "For a headache, try drinking a glass of water and resting in a quiet, dark room. Check your blood pressure if possible.";
                    else if(lower.includes('chest pain')) responseText = "âš ï¸ Chest pain can be serious. Please use the SOS button immediately or call emergency services if it persists.";
                    else if(lower.includes('dizzy')) responseText = "Sit down slowly to avoid falling. Drink water. If you are diabetic, check your sugar levels.";
                    else if(lower.includes('thank')) responseText = "You are welcome! Take care.";
                    else if(lower.includes('hi') || lower.includes('hello')) responseText = "Hello! How can I help you with your health today?";

                    setMessages(prev => [...prev, { id: Date.now() + 1, sender: 'bot', text: responseText }]);
                    setIsTyping(false);
                }, 1500);
            };

            return (
                <div className="p-4 md:p-6 h-[calc(100vh-80px)] flex flex-col fade-in">
                    <div className="bg-white rounded-t-2xl p-4 border-b flex items-center gap-3 shadow-sm">
                        <div className="w-10 h-10 bg-gradient-to-tr from-blue-600 to-cyan-500 rounded-full flex items-center justify-center text-white"><i className="ph-fill ph-robot text-xl"></i></div>
                        <div>
                            <h2 className="font-bold text-slate-800">Sushruta Assistant</h2>
                            <p className="text-xs text-slate-500 flex items-center gap-1"><span className="w-2 h-2 bg-green-500 rounded-full block"></span> Online</p>
                        </div>
                    </div>
                    
                    <div className="flex-1 bg-slate-50 p-4 overflow-y-auto custom-scroll flex flex-col">
                        {messages.map(m => (
                            <div key={m.id} className={`chat-bubble shadow-sm ${m.sender === 'user' ? 'chat-user' : 'chat-bot'}`}>
                                {m.text}
                            </div>
                        ))}
                        {isTyping && (
                            <div className="chat-bubble chat-bot w-16 text-center">
                                <span className="typing-dot"></span><span className="typing-dot"></span><span className="typing-dot"></span>
                            </div>
                        )}
                        <div ref={chatEndRef}></div>
                    </div>

                    <form onSubmit={handleSend} className="bg-white p-4 rounded-b-2xl border-t flex gap-2">
                        <input 
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            placeholder="Type your symptoms or question..."
                            className="flex-1 p-3 bg-slate-100 rounded-xl outline-none focus:ring-2 focus:ring-blue-500 transition"
                        />
                        <button type="submit" className="bg-blue-600 text-white p-3 rounded-xl hover:bg-blue-700 transition shadow-lg"><i className="ph-bold ph-paper-plane-right text-xl"></i></button>
                    </form>
                </div>
            );
        };
        const GPSModule = () => {
  const [coords, setCoords] = React.useState(null);
  const [loading, setLoading] = React.useState(true);
  const [error, setError] = React.useState("");

  React.useEffect(() => {
    if (!navigator.geolocation) {
      setError("Geolocation not supported");
      setLoading(false);
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        setCoords({
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        });
        setLoading(false);
      },
      () => {
        setError("Location permission denied");
        setLoading(false);
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  }, []);

  return (
    <div className="p-6 fade-in">
      <h1 className="text-2xl font-bold text-slate-800 mb-4">
        Live GPS Location
      </h1>

      {loading && <p className="text-slate-500">Fetching locationâ€¦</p>}
      {error && <p className="text-red-500 font-semibold">{error}</p>}

      {coords && (
        <>
          <div className="w-full h-96 rounded-2xl overflow-hidden border mb-4">
            <iframe
              title="Live Location"
              src={`https://maps.google.com/maps?q=${coords.lat},${coords.lng}&z=15&output=embed`}
              className="w-full h-full border-none"
              loading="lazy"
            />
          </div>

          <div className="flex justify-between items-center bg-slate-50 p-4 rounded-xl">
            <p className="text-xs font-mono text-slate-600">
              LAT: {coords.lat.toFixed(5)} | LNG: {coords.lng.toFixed(5)}
            </p>

            <a
              href={`https://www.google.com/maps?q=${coords.lat},${coords.lng}`}
              target="_blank"
              rel="noreferrer"
              className="text-blue-600 text-xs font-bold hover:underline"
            >
              Open in Google Maps
            </a>
          </div>
        </>
      )}
    </div>
  );
};


        // --- REPORTS TAB (FIXED: FILE UPLOAD + TABLE + REALTIME DATA) ---
        const ReportsTab = ({ data, refreshData }) => {
            const [localReports, setLocalReports] = useState(data.reports || []);
            const [uploading, setUploading] = useState(false);
            const [reportName, setReportName] = useState('');
            const [docName, setDocName] = useState('');
            const [searchTerm, setSearchTerm] = useState('');
            const [sortConfig, setSortConfig] = useState({ key: 'date', direction: 'desc' });
            const fileInput = useRef(null);
            const [previewFile, setPreviewFile] = useState(null);
            const [storageSize, setStorageSize] = useState(MockBackend.getStorageSize());

            useEffect(() => {
                setLocalReports(data.reports || []);
            }, [data.reports]);

            // Real-Time Stats
            const histSteps = data.history?.steps || [];
            const avgSteps = histSteps.length ? Math.round(histSteps.reduce((a, b) => a + b, 0) / histSteps.length) : 0;
            const histHeart = data.history?.heart || [];
            const avgHeart = histHeart.length ? Math.round(histHeart.reduce((a, b) => a + b, 0) / histHeart.length) : 0;
            const histSleep = data.history?.sleep || [];
            const avgSleep = histSleep.length ? (histSleep.reduce((a, b) => a + b, 0) / histSleep.length).toFixed(1) : "0.0";
            const takenCount = (data.meds || []).filter(m => m.taken).length;
            const totalMeds = (data.meds || []).length || 1;
            const adherence = Math.round((takenCount / totalMeds) * 100);

            // Handle File Upload
            const handleFile = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                setUploading(true);
                const reader = new FileReader();
                reader.onload = (e) => {
                    const now = new Date();
                    const newReport = {
                        id: Date.now(),
                        name: reportName.trim() || `Report ${now.toLocaleDateString()}`, 
                        doctor: docName.trim() || "Self Upload", 
                        date: now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                        time: now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),
                        type: file.type,
                        content: e.target.result 
                    };
                    
                    const currentData = MockBackend.getData();
                    const updatedReports = [newReport, ...(currentData.reports || [])];
                    const newData = { ...currentData, reports: updatedReports };
                    
                    const success = MockBackend.updateData(newData);
                    
                    if (success) {
                        setLocalReports(updatedReports);
                        setStorageSize(MockBackend.getStorageSize());
                        if (refreshData) refreshData();
                        setReportName('');
                        setDocName('');
                        alert("File Added Successfully!");
                    }
                    
                    setUploading(false);
                    if(fileInput.current) fileInput.current.value = "";
                };
                reader.readAsDataURL(file);
            };

            const deleteReport = (e, id) => {
                e.stopPropagation();
                if(confirm('Delete this report?')) {
                    const currentData = MockBackend.getData();
                    const updatedReports = (currentData.reports || []).filter(r => r.id !== id);
                    const newData = { ...currentData, reports: updatedReports };
                    MockBackend.updateData(newData);
                    
                    setLocalReports(updatedReports);
                    setStorageSize(MockBackend.getStorageSize());
                    if (refreshData) refreshData();
                }
            };

            const sortedReports = useMemo(() => {
                let sortableItems = [...localReports];
                if (searchTerm) {
                    sortableItems = sortableItems.filter(item => 
                        item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        item.doctor.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }
                if (sortConfig !== null) {
                    sortableItems.sort((a, b) => {
                        if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.direction === 'ascending' ? -1 : 1;
                        if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.direction === 'ascending' ? 1 : -1;
                        return 0;
                    });
                }
                return sortableItems;
            }, [localReports, searchTerm, sortConfig]);

            const requestSort = (key) => {
                let direction = 'ascending';
                if (sortConfig.key === key && sortConfig.direction === 'ascending') direction = 'descending';
                setSortConfig({ key, direction });
            };

            return (
                <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
                    {previewFile && (
                        <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4 fade-in" onClick={() => setPreviewFile(null)}>
                            <div className="relative max-w-4xl max-h-[90vh] w-full bg-transparent" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setPreviewFile(null)} className="absolute -top-10 right-0 text-white text-3xl hover:scale-110 transition"><i className="ph-bold ph-x"></i></button>
                                {previewFile.type.includes('image') ? (
                                    <img src={previewFile.content} className="w-full h-auto max-h-[80vh] object-contain rounded-lg shadow-2xl bg-black" />
                                ) : (
                                    <iframe src={previewFile.content} className="w-full h-[80vh] rounded-lg bg-white" title="PDF Preview"></iframe>
                                )}
                            </div>
                        </div>
                    )}

                    <div className="flex justify-between items-center">
                        <div>
                            <h1 className="text-2xl font-bold text-slate-800">Medical Archives</h1>
                            <p className="text-slate-500 text-sm">Manage and view your health records</p>
                        </div>
                    </div>

                    {/* WEEKLY OVERVIEW CARDS */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 w-full">
                        <div className="bg-gradient-to-br from-blue-50 to-white p-5 rounded-2xl border border-blue-100 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group hover:shadow-md transition">
                            <div className="absolute right-0 top-0 w-24 h-24 bg-blue-100 rounded-full -mr-10 -mt-10 opacity-50 group-hover:scale-110 transition"></div>
                            <div className="relative z-10">
                                <p className="text-xs font-bold text-blue-500 uppercase tracking-wider mb-1">AVG STEPS</p>
                                <h3 className="text-3xl font-extrabold text-slate-800">{avgSteps.toLocaleString()}</h3>
                            </div>
                            <div className="relative z-10 w-full bg-blue-100 h-1.5 rounded-full mt-2"><div className="bg-blue-500 h-1.5 rounded-full" style={{width: '65%'}}></div></div>
                        </div>
                        <div className="bg-gradient-to-br from-red-50 to-white p-5 rounded-2xl border border-red-100 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group hover:shadow-md transition">
                            <div className="absolute right-0 top-0 w-24 h-24 bg-red-100 rounded-full -mr-10 -mt-10 opacity-50 group-hover:scale-110 transition"></div>
                            <div className="relative z-10">
                                <p className="text-xs font-bold text-red-500 uppercase tracking-wider mb-1">AVG HEART RATE</p>
                                <h3 className="text-3xl font-extrabold text-slate-800">{avgHeart} <span className="text-sm text-slate-400">bpm</span></h3>
                            </div>
                            <div className="relative z-10 flex items-center gap-1 text-xs text-red-600 font-bold mt-2"><i className="ph-fill ph-heartbeat"></i> Normal</div>
                        </div>
                        <div className="bg-gradient-to-br from-emerald-50 to-white p-5 rounded-2xl border border-emerald-100 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group hover:shadow-md transition">
                            <div className="absolute right-0 top-0 w-24 h-24 bg-emerald-100 rounded-full -mr-10 -mt-10 opacity-50 group-hover:scale-110 transition"></div>
                            <div className="relative z-10">
                                <p className="text-xs font-bold text-emerald-600 uppercase tracking-wider mb-1">MED ADHERENCE</p>
                                <h3 className="text-3xl font-extrabold text-slate-800">{adherence}%</h3>
                            </div>
                            <div className="relative z-10 w-full bg-emerald-100 h-1.5 rounded-full mt-2"><div className="bg-emerald-500 h-1.5 rounded-full" style={{width: `${adherence}%`}}></div></div>
                        </div>
                        <div className="bg-gradient-to-br from-purple-50 to-white p-5 rounded-2xl border border-purple-100 shadow-sm flex flex-col justify-between h-32 relative overflow-hidden group hover:shadow-md transition">
                            <div className="absolute right-0 top-0 w-24 h-24 bg-purple-100 rounded-full -mr-10 -mt-10 opacity-50 group-hover:scale-110 transition"></div>
                            <div className="relative z-10">
                                <p className="text-xs font-bold text-purple-600 uppercase tracking-wider mb-1">AVG SLEEP</p>
                                <h3 className="text-3xl font-extrabold text-slate-800">{avgSleep} <span className="text-sm text-slate-400">hrs</span></h3>
                            </div>
                            <div className="relative z-10 flex items-center gap-1 text-xs text-purple-600 font-bold mt-2"><i className="ph-fill ph-moon-stars"></i> Optimal</div>
                        </div>
                    </div>

                    {/* UPLOAD SECTION */}
                    <div className="bg-white rounded-2xl shadow-sm border border-dashed border-slate-300 p-8 text-center relative group hover:border-blue-400 transition-colors">
                        <div className="absolute inset-0 bg-blue-50 opacity-0 group-hover:opacity-50 transition-opacity rounded-2xl pointer-events-none"></div>
                        <div className="relative z-10 max-w-2xl mx-auto">
                            <div className="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                <i className="ph-fill ph-cloud-arrow-up text-3xl"></i>
                            </div>
                            <h3 className="text-lg font-bold text-slate-700 mb-2">Upload New Record</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-left">
                                <div>
                                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Report Name</label>
                                    <input 
                                        type="text" 
                                        placeholder="e.g. Lab Report Dec '25" 
                                        className="w-full p-2 border rounded-lg text-sm outline-none focus:border-blue-500 bg-white" 
                                        value={reportName} 
                                        onChange={e => setReportName(e.target.value)} 
                                    />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-slate-500 uppercase mb-1 block">Prescribed By (Dr.)</label>
                                    <input 
                                        type="text" 
                                        placeholder="e.g. Dr. Sharma" 
                                        className="w-full p-2 border rounded-lg text-sm outline-none focus:border-blue-500 bg-white" 
                                        value={docName} 
                                        onChange={e => setDocName(e.target.value)} 
                                    />
                                </div>
                            </div>
                            <button onClick={() => fileInput.current.click()} className="bg-blue-900 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg hover:bg-blue-800 transition flex items-center gap-2 mx-auto">
                                {uploading ? <i className="ph-bold ph-spinner animate-spin"></i> : <i className="ph-bold ph-file-plus"></i>}
                                {uploading ? 'Uploading...' : 'Select File (JPG/PDF)'}
                            </button>
                            <input type="file" ref={fileInput} className="hidden" accept="image/*,application/pdf" onChange={handleFile} />
                        </div>
                    </div>

                    {/* INNOVATIVE INTERACTIVE TABLE */}
                    <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                        {/* Table Header / Toolbar */}
                        <div className="p-4 border-b bg-slate-50 flex flex-col md:flex-row justify-between items-center gap-4">
                            <h3 className="font-bold text-slate-700 flex items-center gap-2"><i className="ph-duotone ph-files text-xl"></i> Uploaded Documents ({sortedReports.length})</h3>
                            <div className="relative w-full md:w-64">
                                <i className="ph-bold ph-magnifying-glass absolute left-3 top-2.5 text-slate-400"></i>
                                <input 
                                    type="text" 
                                    placeholder="Search reports..." 
                                    className="w-full pl-9 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-100 transition"
                                    value={searchTerm}
                                    onChange={e => setSearchTerm(e.target.value)}
                                />
                            </div>
                        </div>

                        {/* Table Content */}
                        <div className="overflow-x-auto">
                            <table className="modern-table w-full text-left">
                                <thead>
                                    <tr>
                                        <th className="cursor-pointer hover:text-blue-600 transition" onClick={() => requestSort('name')}>
                                            Document Name {sortConfig.key === 'name' && (sortConfig.direction === 'ascending' ? 'â–²' : 'â–¼')}
                                        </th>
                                        <th className="cursor-pointer hover:text-blue-600 transition" onClick={() => requestSort('doctor')}>
                                            Doctor {sortConfig.key === 'doctor' && (sortConfig.direction === 'ascending' ? 'â–²' : 'â–¼')}
                                        </th>
                                        <th className="cursor-pointer hover:text-blue-600 transition" onClick={() => requestSort('date')}>
                                            Uploaded Date {sortConfig.key === 'date' && (sortConfig.direction === 'ascending' ? 'â–²' : 'â–¼')}
                                        </th>
                                        <th>Type</th>
                                        <th className="text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {sortedReports.length === 0 ? (
                                        <tr>
                                            <td colSpan="5" className="p-10 text-center text-slate-400">
                                                <div className="flex flex-col items-center">
                                                    <div className="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-3"><i className="ph-duotone ph-folder-dashed text-3xl"></i></div>
                                                    <p>No records found matching your search.</p>
                                                </div>
                                            </td>
                                        </tr>
                                    ) : (
                                        sortedReports.map((report) => (
                                            <tr 
                                                key={report.id} 
                                                className="group"
                                                onClick={() => setPreviewFile(report)}
                                            >
                                                <td className="px-6 py-5">
                                                    <div className="flex items-center gap-4">
                                                        <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-md ${report.type.includes('pdf') ? 'bg-red-500' : 'bg-blue-500'}`}>
                                                            <i className={`ph-bold ${report.type.includes('pdf') ? 'ph-file-pdf' : 'ph-image'} text-xl`}></i>
                                                        </div>
                                                        <div>
                                                            <p className="font-bold text-slate-800 text-sm">{report.name}</p>
                                                            <p className="text-[10px] text-slate-400 font-mono">ID: #{report.id.toString().slice(-4)}</p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td className="px-6 py-5">
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-xs font-bold text-slate-600 border border-slate-200">
                                                            {report.doctor.charAt(0)}
                                                        </div>
                                                        <span className="text-sm font-semibold text-slate-600">Dr. {report.doctor}</span>
                                                    </div>
                                                </td>
                                                <td className="px-6 py-5 whitespace-nowrap">
                                                    <p className="text-sm font-medium text-slate-700">{report.date}</p>
                                                    <p className="text-xs text-slate-400">{report.time}</p>
                                                </td>
                                                <td className="px-6 py-5 whitespace-nowrap">
                                                    <span className={`status-badge ${report.type.includes('pdf') ? 'badge-pdf' : 'badge-img'}`}>
                                                        {report.type.includes('pdf') ? 'PDF Document' : 'Image File'}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-5 text-right">
                                                    <div className="flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity transform translate-x-2 group-hover:translate-x-0 duration-300">
                                                        <button 
                                                            onClick={(e) => { e.stopPropagation(); setPreviewFile(report); }}
                                                            className="p-2 rounded-lg bg-white border border-slate-200 text-blue-600 hover:bg-blue-50 hover:border-blue-200 transition shadow-sm"
                                                            title="View"
                                                        >
                                                            <i className="ph-bold ph-eye"></i>
                                                        </button>
                                                        <button 
                                                            onClick={(e) => deleteReport(e, report.id)}
                                                            className="p-2 rounded-lg bg-white border border-slate-200 text-red-500 hover:bg-red-50 hover:border-red-200 transition shadow-sm"
                                                            title="Delete"
                                                        >
                                                            <i className="ph-bold ph-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                        {/* Footer */}
                        <div className="p-4 bg-slate-50 border-t flex justify-between items-center">
                            <p className="text-xs text-slate-400 font-medium">Showing {sortedReports.length} records</p>
                            {/* Dummy Pagination */}
                            <div className="flex gap-1">
                                <button className="p-1 px-2 text-xs rounded border bg-white text-slate-400" disabled>Prev</button>
                                <button className="p-1 px-2 text-xs rounded border bg-white text-slate-600">1</button>
                                <button className="p-1 px-2 text-xs rounded border bg-white text-slate-400" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        // --- NEW FEATURE: APPOINTMENT SYSTEM (Innovative Modal + Compact Time) ---
        const AppointmentsTab = ({ data, user, refreshData }) => {
            const [view, setView] = useState('list'); 
            const [formData, setFormData] = useState({
                doctorName: '',
                specialization: 'General Physician',
                date: '',
                time: '', 
                reason: ''
            });

            const [timeState, setTimeState] = useState({ hh: '', mm: '', period: 'AM' });

            // Sync Time
            useEffect(() => {
                const { hh, mm, period } = timeState;
                if(hh && mm) {
                    let hours = parseInt(hh);
                    const minutes = parseInt(mm);
                    if(hours > 12) hours = 12;
                    if(minutes > 59) setTimeState(prev => ({...prev, mm: '59'}));
                    let hours24 = hours;
                    if (period === 'PM' && hours < 12) hours24 += 12;
                    if (period === 'AM' && hours === 12) hours24 = 0;
                    const timeStr = `${hours24.toString().padStart(2, '0')}:${mm.toString().padStart(2, '0')}`;
                    setFormData(prev => ({ ...prev, time: timeStr }));
                }
            }, [timeState]);

            const appointments = data.appointments || [];

            // --- BOOKING LOGIC ---
            const handleBook = (e) => {
                e.preventDefault();
                if(!formData.time || !timeState.hh || !timeState.mm) return alert("Please enter a valid time.");
                
                const newAppointment = {
                    id: Date.now(),
                    patientId: user.phone,
                    patientName: user.name,
                    ...formData,
                    status: 'Pending', 
                    notified: false
                };

                const currentData = MockBackend.getData();
                const updatedAppointments = [...(currentData.appointments || []), newAppointment];
                MockBackend.updateData({ ...currentData, appointments: updatedAppointments });
                
                refreshData();
                setView('list');
                setFormData({ doctorName: '', specialization: 'General Physician', date: '', time: '', reason: '' });
                setTimeState({ hh: '', mm: '', period: 'AM' });
                alert("Appointment Request Sent to Doctor!");
            };

            // --- DOCTOR UPDATE ---
            const updateStatus = (id, newStatus) => {
                const currentData = MockBackend.getData();
                const updatedAppointments = currentData.appointments.map(app => 
                    app.id === id ? { ...app, status: newStatus } : app
                );
                MockBackend.updateData({ ...currentData, appointments: updatedAppointments });
                refreshData();
            };

            // --- RENDER: DOCTOR VIEW ---
            if (user.role === 'doctor') {
                const myAppointments = appointments.filter(app => app.status !== 'Rejected'); 
                return (
                    <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-bold text-slate-800">Doctor Dashboard</h1>
                                <p className="text-slate-500">Manage patient appointments</p>
                            </div>
                            <div className="bg-blue-100 text-blue-800 px-4 py-2 rounded-lg font-bold">
                                {myAppointments.filter(a => a.status === 'Pending').length} Pending Requests
                            </div>
                        </div>
                        <div className="grid gap-4">
                            {myAppointments.length === 0 ? (
                                <div className="text-center p-10 text-slate-400 bg-white rounded-2xl border border-dashed">No appointments yet.</div>
                            ) : (
                                myAppointments.map(app => (
                                    <div key={app.id} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4">
                                        <div className="flex items-center gap-4">
                                            <div className="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-xl font-bold text-slate-500">{app.patientName.charAt(0)}</div>
                                            <div>
                                                <h3 className="font-bold text-lg text-slate-800">{app.patientName}</h3>
                                                <p className="text-sm text-slate-500">{app.reason}</p>
                                                <div className="flex gap-2 mt-1 text-xs font-bold">
                                                    <span className="bg-blue-50 text-blue-600 px-2 py-1 rounded"><i className="ph-bold ph-calendar"></i> {app.date}</span>
                                                    <span className="bg-purple-50 text-purple-600 px-2 py-1 rounded"><i className="ph-bold ph-clock"></i> {app.time}</span>
                                                </div>
                                            </div>
                                        </div>
                                        {app.status === 'Pending' ? (
                                            <div className="flex gap-3">
                                                <button onClick={() => updateStatus(app.id, 'Confirmed')} className="px-6 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl font-bold shadow-md transition">Accept</button>
                                                <button onClick={() => updateStatus(app.id, 'Rejected')} className="px-6 py-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl font-bold transition">Reject</button>
                                            </div>
                                        ) : (
                                            <span className="px-4 py-2 bg-green-100 text-green-700 font-bold rounded-xl border border-green-200"><i className="ph-bold ph-check-circle"></i> Confirmed</span>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                );
            }

            // --- RENDER: USER VIEW ---
            return (
                <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
                    {view === 'list' && (
                        <>
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-2xl font-bold text-slate-800">My Appointments</h1>
                                    <p className="text-slate-500">Track your doctor visits</p>
                                </div>
                                <button onClick={() => setView('book')} className="bg-blue-900 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-800 transition flex items-center gap-2">
                                    <i className="ph-bold ph-plus"></i> Book New
                                </button>
                            </div>

                            <div className="space-y-4">
                                {appointments.filter(a => a.patientId === user.phone).length === 0 ? (
                                    <div className="text-center p-12 bg-white rounded-2xl border border-dashed border-slate-300">
                                        <i className="ph-duotone ph-calendar-x text-4xl text-slate-300 mb-2"></i>
                                        <p className="text-slate-500">No appointments booked yet.</p>
                                    </div>
                                ) : (
                                    appointments.filter(a => a.patientId === user.phone).map(app => (
                                        <div key={app.id} className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden">
                                            <div className={`absolute left-0 top-0 bottom-0 w-2 ${app.status === 'Confirmed' ? 'bg-emerald-500' : app.status === 'Rejected' ? 'bg-red-500' : 'bg-amber-400'}`}></div>
                                            <div className="pl-4 flex justify-between items-start">
                                                <div>
                                                    <h3 className="font-bold text-lg text-slate-800">Dr. {app.doctorName}</h3>
                                                    <p className="text-sm text-slate-500 mb-2">{app.specialization}</p>
                                                    <div className="flex flex-wrap gap-2 text-sm">
                                                        <span className="flex items-center gap-1 bg-slate-100 px-2 py-1 rounded"><i className="ph-bold ph-calendar-blank"></i> {app.date}</span>
                                                        <span className="flex items-center gap-1 bg-slate-100 px-2 py-1 rounded"><i className="ph-bold ph-clock"></i> {app.time}</span>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <span className={`px-3 py-1 rounded-lg text-xs font-bold uppercase tracking-wider ${app.status === 'Confirmed' ? 'bg-emerald-100 text-emerald-700' : app.status === 'Rejected' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'}`}>{app.status}</span>
                                                    <p className="text-xs text-slate-400 mt-2">ID: #{app.id.toString().slice(-4)}</p>
                                                </div>
                                            </div>
                                            {app.status === 'Confirmed' && (
                                                <div className="mt-4 pt-4 border-t text-xs text-slate-500 flex items-center gap-2"><i className="ph-fill ph-bell-ringing text-blue-500"></i> You will be notified 1 hour before.</div>
                                            )}
                                        </div>
                                    ))
                                )}
                            </div>

                            {/* --- eSANJEEVANI HERO SECTION --- */}
                            <div className="mt-10 relative overflow-hidden rounded-3xl bg-gradient-to-br from-indigo-900 via-purple-900 to-indigo-800 text-white shadow-2xl transform transition hover:scale-[1.01] duration-500 group">
                                <div className="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl -mr-16 -mt-16"></div>
                                <div className="absolute bottom-0 left-0 w-40 h-40 bg-purple-500 opacity-10 rounded-full blur-2xl -ml-10 -mb-10"></div>

                                <div className="relative z-10 p-8 md:p-10 flex flex-col md:flex-row items-center gap-8">
                                    <div className="flex-1 text-center md:text-left">
                                        <div className="inline-flex items-center gap-2 bg-purple-500/20 border border-purple-500/50 text-purple-200 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-4 backdrop-blur-sm">
                                            <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span> Ministry of Health
                                        </div>
                                        <h2 className="text-3xl md:text-4xl font-bold mb-4 leading-tight">
                                            eSanjeevani <br/>
                                            <span className="text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-pink-200">National OPD</span>
                                        </h2>
                                        <p className="text-indigo-100 mb-8 text-lg opacity-90 max-w-lg">
                                            Cannot visit a clinic? Consult specialist doctors from home via <strong>Video Call for FREE</strong>.
                                        </p>
                                        <a href="https://esanjeevani.mohfw.gov.in/" target="_blank" className="inline-flex items-center gap-3 bg-white text-indigo-900 px-8 py-4 rounded-xl font-bold shadow-lg hover:bg-purple-50 transition-all active:scale-95 group-hover:shadow-purple-500/20">
                                            <span>Start Free Video Call</span>
                                            <i className="ph-bold ph-video-camera"></i>
                                        </a>
                                    </div>

                                    {/* EXPENSE COMPARISON GRAPH */}
                                    <div className="w-full md:w-72 bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-xl">
                                        <h4 className="text-sm font-bold text-center mb-6 opacity-80 uppercase tracking-widest">Consultation Cost</h4>
                                        <div className="flex justify-center items-end gap-6 h-32">
                                            <div className="w-16 flex flex-col items-center gap-2 group/bar">
                                                <span className="text-xs font-bold text-white mb-1">â‚¹500+</span>
                                                <div className="w-full bg-red-400/80 rounded-t-lg h-24 relative group-hover/bar:bg-red-400 transition-colors"></div>
                                                <span className="text-[10px] opacity-70 text-center">Clinic</span>
                                            </div>
                                            <div className="w-16 flex flex-col items-center gap-2 group/bar">
                                                <span className="text-xs font-bold text-green-300 mb-1">FREE</span>
                                                <div className="w-full bg-green-400 rounded-t-lg h-6 relative animate-bounce">
                                                    <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded whitespace-nowrap shadow-lg">
                                                        FREE
                                                    </div>
                                                </div>
                                                <span className="text-[10px] font-bold text-green-200 text-center">eSanjeevani</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </>
                    )}

                    {view === 'book' && (
                        <div className="max-w-xl mx-auto bg-white rounded-3xl shadow-2xl slide-up overflow-hidden border border-slate-100">
                            {/* Modal Header */}
                            <div className="bg-gradient-to-r from-blue-900 to-indigo-900 p-6 text-white flex justify-between items-center">
                                <div>
                                    <h2 className="text-2xl font-bold">Book Appointment</h2>
                                    <p className="text-blue-200 text-sm">Schedule a visit with your specialist</p>
                                </div>
                                <button onClick={() => setView('list')} className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition">
                                    <i className="ph-bold ph-x text-xl"></i>
                                </button>
                            </div>

                            <form onSubmit={handleBook} className="p-8 space-y-6">
                                
                                {/* 1. DOCTOR SELECT */}
                                <div className="space-y-2">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Choose Specialist</label>
                                    <div className="relative">
                                        <i className="ph-fill ph-stethoscope absolute left-4 top-3.5 text-blue-600 text-xl"></i>
                                        <select 
                                            className="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/50 appearance-none font-medium text-slate-700 transition-all" 
                                            required 
                                            onChange={e => setFormData({...formData, doctorName: e.target.value})}
                                        >
                                            <option value="">Select a Doctor...</option>
                                            <option value="Sharma">Dr. Sharma (Cardiologist)</option>
                                            <option value="Gupta">Dr. Gupta (Orthopedic)</option>
                                            <option value="Verma">Dr. Verma (General Physician)</option>
                                        </select>
                                        <i className="ph-bold ph-caret-down absolute right-4 top-4 text-slate-400"></i>
                                    </div>
                                </div>

                                {/* 2. DATE & TIME (COMPACT GRID) */}
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Date</label>
                                        <div className="relative">
                                            <i className="ph-fill ph-calendar-blank absolute left-4 top-3.5 text-blue-600 text-xl"></i>
                                            <input 
                                                type="date" 
                                                className="w-full pl-12 pr-2 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/50 font-medium text-slate-700" 
                                                required 
                                                onChange={e => setFormData({...formData, date: e.target.value})} 
                                            />
                                        </div>
                                    </div>

                                    {/* COMPACT TIME INPUT */}
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Time</label>
                                        <div className="flex items-center justify-between bg-slate-50 border border-slate-200 rounded-xl p-2 pl-3 focus-within:ring-2 focus-within:ring-blue-500/50 transition-all h-[50px]">
                                            <div className="flex items-center gap-1">
                                                <input 
                                                    type="number" placeholder="HH" maxLength={2} value={timeState.hh}
                                                    onChange={e => setTimeState({...timeState, hh: e.target.value.slice(0, 2)})}
                                                    className="w-8 bg-transparent text-center text-lg font-bold text-slate-700 outline-none placeholder:text-slate-300 p-0"
                                                />
                                                <span className="text-slate-400 font-bold">:</span>
                                                <input 
                                                    type="number" placeholder="MM" maxLength={2} value={timeState.mm}
                                                    onChange={e => setTimeState({...timeState, mm: e.target.value.slice(0, 2)})}
                                                    className="w-8 bg-transparent text-center text-lg font-bold text-slate-700 outline-none placeholder:text-slate-300 p-0"
                                                />
                                            </div>
                                            <div className="flex gap-1">
                                                <button type="button" onClick={() => setTimeState({...timeState, period: 'AM'})} className={`px-2 py-1.5 text-[10px] font-bold rounded-lg transition-all ${timeState.period === 'AM' ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400 bg-white border border-slate-100'}`}>AM</button>
                                                <button type="button" onClick={() => setTimeState({...timeState, period: 'PM'})} className={`px-2 py-1.5 text-[10px] font-bold rounded-lg transition-all ${timeState.period === 'PM' ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400 bg-white border border-slate-100'}`}>PM</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* 3. REASON */}
                                <div className="space-y-2">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Reason</label>
                                    <div className="relative">
                                        <i className="ph-fill ph-chat-text absolute left-4 top-4 text-blue-600 text-xl"></i>
                                        <textarea 
                                            className="w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500/50 font-medium text-slate-700" 
                                            rows="2" 
                                            placeholder="Symptoms or checkup details..." 
                                            required 
                                            onChange={e => setFormData({...formData, reason: e.target.value})}
                                        ></textarea>
                                    </div>
                                </div>

                                <button className="w-full bg-gradient-to-r from-blue-700 to-indigo-700 text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200 hover:shadow-xl hover:scale-[1.02] transition-all duration-300 flex items-center justify-center gap-2">
                                    <span>Confirm Appointment</span>
                                    <i className="ph-bold ph-check-circle text-xl"></i>
                                </button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };
        // --- NEW FEATURE: INNOVATIVE MEDICINE SHOP ---
        const MedicineShopTab = () => {
            const pharmacies = [
                { 
                    id: 'tata', 
                    name: "Tata 1mg", 
                    desc: "Trusted labs & meds", 
                    url: "https://www.1mg.com/", 
                    icon: "ph-flask", 
                    theme: "hover:border-red-400 hover:shadow-red-100",
                    bg: "bg-red-50 text-red-600"
                },
                { 
                    id: 'apollo', 
                    name: "Apollo 24/7", 
                    desc: "Express Delivery", 
                    url: "https://www.apollopharmacy.in/", 
                    icon: "ph-hospital", 
                    theme: "hover:border-orange-400 hover:shadow-orange-100",
                    bg: "bg-orange-50 text-orange-600"
                },
                { 
                    id: 'flipkart', 
                    name: "Flipkart Health+", 
                    desc: "Best Discounts", 
                    url: "https://healthplus.flipkart.com/", 
                    icon: "ph-shopping-bag", 
                    theme: "hover:border-blue-400 hover:shadow-blue-100",
                    bg: "bg-blue-50 text-blue-600"
                },
                { 
                    id: 'amazon', 
                    name: "Amazon Pharmacy", 
                    desc: "Prime Delivery", 
                    url: "https://www.amazon.in/gp/browse.html?node=1983518031", 
                    icon: "ph-package", 
                    theme: "hover:border-cyan-400 hover:shadow-cyan-100",
                    bg: "bg-cyan-50 text-cyan-600"
                },
                { 
                    id: 'netmeds', 
                    name: "Netmeds", 
                    desc: "India ki Pharmacy", 
                    url: "https://www.netmeds.com/", 
                    icon: "ph-pill", 
                    theme: "hover:border-teal-400 hover:shadow-teal-100",
                    bg: "bg-teal-50 text-teal-600"
                },
                { 
                    id: 'pharmeasy', 
                    name: "PharmEasy", 
                    desc: "Take it Easy", 
                    url: "https://pharmeasy.in/", 
                    // UPDATED ICON HERE:
                    icon: "ph-first-aid", 
                    theme: "hover:border-emerald-400 hover:shadow-emerald-100",
                    bg: "bg-emerald-50 text-emerald-600"
                }
            ];

            return (
                <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
                    
                    {/* HEADER */}
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h1 className="text-2xl md:text-3xl font-bold text-slate-800 flex items-center gap-2">
                                <i className="ph-duotone ph-shopping-cart text-blue-600"></i> Medicine Hub
                            </h1>
                            <p className="text-slate-500">Compare prices & order from trusted sources</p>
                        </div>
                    </div>

                    {/* HERO SECTION: JAN AUSHADHI (GOVT SCHEME) */}
                    <div className="relative overflow-hidden rounded-3xl bg-gradient-to-br from-indigo-900 via-blue-800 to-blue-900 text-white shadow-2xl transform transition hover:scale-[1.01] duration-500 group">
                        
                        {/* Background Decoration */}
                        <div className="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl -mr-16 -mt-16"></div>
                        <div className="absolute bottom-0 left-0 w-40 h-40 bg-orange-500 opacity-10 rounded-full blur-2xl -ml-10 -mb-10"></div>

                        <div className="relative z-10 p-8 md:p-10 flex flex-col md:flex-row items-center gap-8">
                            
                            {/* Left Content */}
                            <div className="flex-1 text-center md:text-left">
                                <div className="inline-flex items-center gap-2 bg-orange-500/20 border border-orange-500/50 text-orange-200 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-4 backdrop-blur-sm">
                                    <span className="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></span> Govt. Recommended
                                </div>
                                <h2 className="text-3xl md:text-4xl font-bold mb-4 leading-tight">
                                    Pradhan Mantri <br/>
                                    <span className="text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-yellow-200">Bhartiya Janaushadhi</span>
                                </h2>
                                <p className="text-blue-100 mb-8 text-lg opacity-90 max-w-lg">
                                    Why pay more? Get high-quality generic medicines at <strong>50% to 90% lower prices</strong> than branded alternatives.
                                </p>
                                <a 
                                    // UPDATE THIS LINK TOO:
                                    href="https://janaushadhi.gov.in/near-by-kendra" 
                                    target="_blank" 
                                    className="inline-flex items-center gap-3 bg-white text-blue-900 px-8 py-4 rounded-xl font-bold shadow-lg hover:bg-orange-50 transition-all active:scale-95 group-hover:shadow-orange-500/20"
                                >
                                    <span>Find Jan Aushadhi Store</span>
                                    <i className="ph-bold ph-arrow-right"></i>
                                </a>
                            </div>

                            {/* Right Visual: Price Comparison Graph */}
                            <div className="w-full md:w-72 bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 shadow-xl">
                                <h4 className="text-sm font-bold text-center mb-6 opacity-80 uppercase tracking-widest">Price Comparison</h4>
                                <div className="flex justify-center items-end gap-6 h-32">
                                    <div className="w-16 flex flex-col items-center gap-2 group/bar">
                                        <span className="text-xs font-bold opacity-0 group-hover/bar:opacity-100 transition-opacity">â‚¹100</span>
                                        <div className="w-full bg-red-400/80 rounded-t-lg h-24 relative group-hover/bar:bg-red-400 transition-colors"></div>
                                        <span className="text-[10px] opacity-70">Branded</span>
                                    </div>
                                    <div className="w-16 flex flex-col items-center gap-2 group/bar">
                                        <span className="text-xs font-bold text-green-300 opacity-0 group-hover/bar:opacity-100 transition-opacity">â‚¹10</span>
                                        <div className="w-full bg-green-400 rounded-t-lg h-6 relative animate-bounce">
                                            <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded whitespace-nowrap shadow-lg">
                                                Save 90%
                                            </div>
                                        </div>
                                        <span className="text-[10px] font-bold text-green-200">Generic</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* PRIVATE PHARMACIES GRID */}
                    <div>
                        <h3 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                            <i className="ph-fill ph-storefront text-slate-400"></i> Other Trusted Pharmacies
                        </h3>
                        
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
                            {pharmacies.map((shop) => (
                                <a 
                                    key={shop.id} 
                                    href={shop.url} 
                                    target="_blank" 
                                    className={`bg-white p-5 rounded-2xl border border-slate-100 shadow-sm transition-all duration-300 group flex items-center gap-4 hover:-translate-y-1 ${shop.theme}`}
                                >
                                    <div className={`w-14 h-14 rounded-2xl flex items-center justify-center text-2xl transition-transform group-hover:scale-110 ${shop.bg}`}>
                                        <i className={`ph-fill ${shop.icon}`}></i>
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <div className="flex justify-between items-center">
                                            <h4 className="font-bold text-slate-700 truncate">{shop.name}</h4>
                                            <i className="ph-bold ph-arrow-up-right text-slate-300 group-hover:text-slate-600 transition-colors"></i>
                                        </div>
                                        <p className="text-xs text-slate-400 mt-1 truncate">{shop.desc}</p>
                                    </div>
                                </a>
                            ))}
                        </div>
                    </div>

                    {/* Safety Note */}
                    <div className="text-center text-xs text-slate-400 mt-8">
                        Disclaimer: Sushruta is an aggregator. Purchases are processed by third-party websites.
                    </div>

                </div>
            );
        };
        // --- NEW FEATURE: GOVERNMENT SCHEMES TAB (Clean UI + New Scheme) ---
        const GovernmentSchemesTab = () => {
            const schemes = [
                {
                    id: 'pmjay',
                    name: "Ayushman Bharat",
                    fullName: "Pradhan Mantri Jan Arogya Yojana",
                    desc: "The world's largest health insurance assurance scheme. Get cashless treatment up to â‚¹5 Lakhs per family per year.",
                    url: "https://pmjay.gov.in/",
                    icon: "ph-shield-check",
                    // Gold/Premium Theme
                    theme: "from-yellow-50 to-amber-100 border-amber-200",
                    accent: "text-amber-700 bg-amber-200/50",
                    badge: "â‚¹5 Lakh Coverage"
                },
                {
                    id: 'esanjeevani',
                    name: "eSanjeevani OPD",
                    fullName: "National Teleconsultation Service",
                    desc: "Connect with doctors via live video call from home. Completely free service by the Ministry of Health.",
                    url: "https://esanjeevani.mohfw.gov.in/",
                    icon: "ph-video-camera",
                    // Digital/Tech Theme
                    theme: "from-fuchsia-50 to-purple-100 border-purple-200",
                    accent: "text-purple-700 bg-purple-200/50",
                    badge: "Free Video Consult",
                    pulse: true
                },
                {
                    id: 'abha',
                    name: "ABHA Health ID",
                    fullName: "Ayushman Bharat Health Account",
                    desc: "Create your unique 14-digit Health ID. Store prescriptions, reports, and diagnoses digitally in one secure place.",
                    url: "https://abha.abdm.gov.in/",
                    icon: "ph-fingerprint",
                    // Security/ID Theme
                    theme: "from-cyan-50 to-blue-100 border-blue-200",
                    accent: "text-blue-700 bg-blue-200/50",
                    badge: "Digital Health Card"
                },
                {
                    id: 'pmbjp',
                    name: "Jan Aushadhi Kendra",
                    fullName: "PM Bhartiya Janaushadhi Pariyojana",
                    desc: "Purchase high-quality generic medicines at 50% to 90% lower prices than branded alternatives.",
                    url: "https://janaushadhi.gov.in/",
                    icon: "ph-pill",
                    // Medical/Green Theme
                    theme: "from-emerald-50 to-teal-100 border-teal-200",
                    accent: "text-teal-700 bg-teal-200/50",
                    badge: "Save 90% Costs"
                },
                {
                    id: 'rvy',
                    name: "Rashtriya Vayoshri",
                    fullName: "Assisted Living Devices Scheme",
                    desc: "Free physical aids (wheelchairs, hearing aids, spectacles, walking sticks) for senior citizens belonging to BPL category.",
                    // UPDATED LINK
                    url: "https://disabilityaffairs.gov.in/content/page/rashtriya-vayoshri-yojana.php",
                    icon: "ph-person-simple-walk",
                    // Welfare/Orange Theme
                    theme: "from-orange-50 to-red-100 border-red-200",
                    accent: "text-red-700 bg-red-200/50",
                    badge: "Free Walking Aids"
                },
                {
                    id: 'nsap', // REPLACED VAYOSHRI WITH PENSION SCHEME
                    name: "Old Age Pension",
                    fullName: "National Social Assistance Programme",
                    desc: "Monthly pension scheme for senior citizens (Indira Gandhi National Old Age Pension Scheme) to ensure financial protection.",
                    url: "https://nsap.nic.in/",
                    icon: "ph-bank", 
                    // Welfare/Orange Theme
                    theme: "from-orange-50 to-red-100 border-red-200",
                    accent: "text-red-700 bg-red-200/50",
                    badge: "Monthly Pension"
                }
            ];

            return (
                <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
                    
                    {/* Clean Header (Removed Black Background) */}
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div className="flex items-center gap-4">
                            <div className="w-16 h-16 rounded-2xl bg-orange-50 flex items-center justify-center border border-orange-100 shadow-sm shrink-0">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/5/55/Emblem_of_India.svg" className="h-10 w-auto opacity-90" alt="Emblem" />
                            </div>
                            <div>
                                <h1 className="text-2xl md:text-3xl font-bold text-slate-800">Government Benefits</h1>
                                <p className="text-slate-500 font-medium">Official welfare schemes & digital services</p>
                            </div>
                        </div>
                    </div>

                    {/* Disclaimer */}
                    <div className="flex items-center gap-3 text-xs md:text-sm text-blue-800 bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <i className="ph-fill ph-info text-xl shrink-0"></i>
                        <span>Links direct to <strong>official .gov.in</strong> portals. Please check eligibility before applying.</span>
                    </div>

                    {/* Innovative Grid Layout (1 Mobile, 2 Desktop) */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {schemes.map((scheme) => (
                            <a 
                                key={scheme.id}
                                href={scheme.url}
                                target="_blank" 
                                rel="noopener noreferrer"
                                className={`group relative bg-gradient-to-br ${scheme.theme} p-1 rounded-3xl transition-all duration-300 hover:-translate-y-2 hover:shadow-xl`}
                            >
                                <div className="bg-white/60 backdrop-blur-xl h-full w-full rounded-[20px] p-6 flex flex-col relative overflow-hidden">
                                    
                                    {/* Decorative Background Icon */}
                                    <i className={`ph-fill ${scheme.icon} absolute -bottom-6 -right-6 text-9xl opacity-5 group-hover:scale-110 transition-transform duration-500`}></i>

                                    {/* Top Section */}
                                    <div className="flex justify-between items-start mb-4">
                                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center text-3xl shadow-sm ${scheme.accent}`}>
                                            <i className={`ph-fill ${scheme.icon} ${scheme.pulse ? 'animate-pulse' : ''}`}></i>
                                        </div>
                                        <span className={`text-[10px] font-bold px-3 py-1.5 rounded-full uppercase tracking-wider shadow-sm flex items-center gap-1.5 ${scheme.accent}`}>
                                            {scheme.pulse && <span className="w-1.5 h-1.5 bg-current rounded-full animate-ping"></span>}
                                            {scheme.badge}
                                        </span>
                                    </div>

                                    {/* Content Section */}
                                    <div className="mb-6 relative z-10">
                                        <h3 className="text-xl font-bold text-slate-800 mb-1 group-hover:text-blue-700 transition-colors">
                                            {scheme.name}
                                        </h3>
                                        <p className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">
                                            {scheme.fullName}
                                        </p>
                                        <p className="text-slate-600 text-sm leading-relaxed font-medium">
                                            {scheme.desc}
                                        </p>
                                    </div>

                                    {/* Bottom Button */}
                                    <div className="mt-auto flex items-center gap-2 text-sm font-bold text-slate-800 group-hover:text-blue-600 transition-colors">
                                        <span className="border-b-2 border-transparent group-hover:border-blue-600">Open Official Portal</span>
                                        <i className="ph-bold ph-arrow-up-right transform group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform"></i>
                                    </div>
                                </div>
                            </a>
                        ))}
                    </div>

                </div>
            );
        };
        // --- NEW FEATURE: EMOTIONAL WELL-BEING (Role-Based) ---
const EmotionalWellnessTab = ({ data, refreshData, userRole }) => {
    // 1. Role Logic
    const role = (userRole || 'senior').toLowerCase();
    const isDoctor = role === 'doctor';
    const isCaretaker = role === 'caretaker';

    // 2. Doctor Blocker
    if (isDoctor) return null;

    // --- State ---
    const [mood, setMood] = useState(null);
    const [breathingActive, setBreathingActive] = useState(false);
    const [breathText, setBreathText] = useState("Tap to Breathe");
    const [breathPhase, setBreathPhase] = useState('idle');
    const [gratitudeInput, setGratitudeInput] = useState("");
    const [isAddingVideo, setIsAddingVideo] = useState(false);
    const [newVideo, setNewVideo] = useState({ title: '', link: '' });

    const wellnessLogs = data.wellnessLogs || [];

    // --- CARETAKER LOGIC: Mood Stats ---
    const today = new Date().toLocaleDateString();
    
    // Filter logs to find mood entries for today
    const todaysMoods = wellnessLogs
        .filter(l => l.type === 'mood' && l.date === today)
        .sort((a, b) => b.id - a.id); // Newest first

    // Calculate Dominant Mood
    const moodCounts = todaysMoods.reduce((acc, curr) => {
        acc[curr.val] = (acc[curr.val] || 0) + 1;
        return acc;
    }, {});
    
    const dominantMood = Object.keys(moodCounts).length > 0 
        ? Object.keys(moodCounts).reduce((a, b) => moodCounts[a] > moodCounts[b] ? a : b) 
        : "No Data";

    // --- Default Library & Handlers ---
    const defaultLibrary = {
        "Anxious": [{ id: 'def1', title: "Gayatri Mantra", type: "Spiritual", dur: "16 min", link: "https://www.youtube.com/watch?v=fMUZKVLLyQI" }],
        "Low": [{ id: 'def6', title: "Laughter Yoga", type: "Comedy", dur: "8 min", link: "https://www.youtube.com/watch?v=ViTeOl0RBHE" }],
        "Happy": [{ id: 'def8', title: "Old Bollywood Lofi", type: "Music", dur: "16 min", link: "https://www.youtube.com/watch?v=qqMoETAVp7U" }],
        "Okay": [{ id: 'def10', title: "Guided Surya Namaskar", type: "Yoga", dur: "15 min", link: "https://www.youtube.com/watch?v=1I9Jn5pj7sA" }]
    };
    const [library, setLibrary] = useState(defaultLibrary);

    // Handlers
    const logMood = (m) => {
        setMood(m); setIsAddingVideo(false);
        const now = new Date();
        const newLog = { 
            id: Date.now(), type: 'mood', val: m, 
            date: now.toLocaleDateString(),
            time: now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) 
        };
        MockBackend.updateData({ ...MockBackend.getData(), wellnessLogs: [newLog, ...(data.wellnessLogs || [])] });
        refreshData();
    };

    const saveGratitude = () => {
        if(!gratitudeInput.trim()) return;
        const now = new Date();
        const newLog = { 
            id: Date.now(), type: 'gratitude', text: gratitudeInput, 
            date: now.toLocaleDateString('en-US', { day: 'numeric', month: 'short' }),
            time: now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) 
        };
        MockBackend.updateData({ ...MockBackend.getData(), wellnessLogs: [newLog, ...(data.wellnessLogs || [])] });
        setGratitudeInput(""); refreshData();
    };

    // Breathing Animation Effect
    useEffect(() => {
        let interval;
        if (breathingActive) {
            let phaseCounter = 0;
            const cycle = () => {
                if(phaseCounter === 0) { setBreathText("Inhale..."); setBreathPhase('inhale'); setTimeout(() => { phaseCounter = 1; cycle(); }, 4000); } 
                else if(phaseCounter === 1) { setBreathText("Hold..."); setBreathPhase('hold'); setTimeout(() => { phaseCounter = 2; cycle(); }, 7000); } 
                else { setBreathText("Exhale..."); setBreathPhase('exhale'); setTimeout(() => { phaseCounter = 0; cycle(); }, 8000); }
            };
            cycle();
        } else { setBreathText("Tap to Breathe"); setBreathPhase('idle'); }
        return () => clearTimeout(interval);
    }, [breathingActive]);

    const moods = [
        { icon: "ph-smiley", label: "Happy", color: "from-yellow-300 to-amber-400", shadow: "shadow-yellow-200" },
        { icon: "ph-smiley-meh", label: "Okay", color: "from-blue-300 to-cyan-400", shadow: "shadow-blue-200" },
        { icon: "ph-smiley-sad", label: "Low", color: "from-slate-300 to-gray-400", shadow: "shadow-gray-200" },
        { icon: "ph-lightning", label: "Anxious", color: "from-orange-300 to-red-400", shadow: "shadow-orange-200" },
    ];

    const breathColors = { idle: 'from-sky-400 to-indigo-500', inhale: 'from-cyan-400 to-blue-500', hold: 'from-violet-500 to-purple-600', exhale: 'from-amber-400 to-orange-500' };

    return (
        <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
            <div>
                <h1 className="text-3xl font-bold text-slate-800 flex items-center gap-3">
                    <span className="w-10 h-10 rounded-full bg-pink-100 flex items-center justify-center text-pink-600"><i className="ph-fill ph-heart"></i></span>
                    Emotional Wellbeing
                </h1>
                <p className="text-slate-500 ml-14">Your sanctuary for mental calm and spiritual joy.</p>
            </div>

            {/* =========================================================
                CARETAKER VIEW: MONITORING DASHBOARD (UPDATED UI)
               ========================================================= */}
            {isCaretaker ? (
                <div className="space-y-8">
                    {/* 1. MOOD MONITOR CARD - FIXED LAYOUT */}
                    <div className="bg-white rounded-[2.5rem] p-8 shadow-xl border border-indigo-50">
                        {/* Card Header */}
                        <div className="flex items-center gap-4 mb-8">
                            <div className="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center text-2xl">
                                <i className="ph-fill ph-chart-pie-slice"></i>
                            </div>
                            <div>
                                <h3 className="text-2xl font-bold text-slate-800">Senior's Emotional Status</h3>
                                <p className="text-sm text-slate-500 font-medium">Daily summary based on logged interactions</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {/* Left: Overall Status Card */}
                            <div className="bg-gradient-to-br from-indigo-50 to-white rounded-3xl p-6 flex flex-col items-center justify-center text-center border border-indigo-100 shadow-sm min-h-[280px]">
                                <div className={`w-24 h-24 rounded-full flex items-center justify-center text-5xl shadow-md mb-6 text-white
                                    ${dominantMood === 'Happy' ? 'bg-amber-400' : dominantMood === 'Anxious' ? 'bg-orange-400' : dominantMood === 'Low' ? 'bg-slate-400' : 'bg-indigo-400'}
                                `}>
                                     <i className={`ph-fill ${dominantMood === 'Happy' ? 'ph-smiley' : dominantMood === 'Anxious' ? 'ph-lightning' : dominantMood === 'Low' ? 'ph-smiley-sad' : 'ph-smiley-meh'}`}></i>
                                </div>
                                <h4 className="text-xs font-extrabold text-indigo-400 uppercase tracking-widest mb-1">Overall Mood Today</h4>
                                <div className="text-4xl font-black text-slate-800 mb-3 tracking-tight">
                                    {dominantMood}
                                </div>
                                <span className="text-xs font-bold text-indigo-600 bg-indigo-100 px-4 py-1.5 rounded-full">
                                    {todaysMoods.length} Check-ins Recorded
                                </span>
                            </div>

                            {/* Right: Detailed Timeline (Fixed Scrolling) */}
                            <div className="bg-slate-50 rounded-3xl p-6 border border-slate-100 flex flex-col h-[280px]">
                                <div className="flex justify-between items-center mb-4 shrink-0">
                                    <h4 className="text-xs font-extrabold text-slate-400 uppercase tracking-widest">Activity Timeline</h4>
                                    <span className="text-[10px] font-bold text-slate-500 bg-white px-2 py-1 rounded-md shadow-sm border border-slate-100">Today</span>
                                </div>
                                
                                <div className="overflow-y-auto custom-scroll flex-1 pr-2 space-y-3">
                                    {todaysMoods.length > 0 ? (
                                        todaysMoods.map((log) => (
                                            <div key={log.id} className="flex items-center justify-between bg-white p-3 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow">
                                                <div className="flex items-center gap-3">
                                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-white text-lg shadow-sm
                                                        ${log.val === 'Happy' ? 'bg-amber-400' : log.val === 'Anxious' ? 'bg-orange-400' : log.val === 'Low' ? 'bg-slate-400' : 'bg-blue-400'}
                                                    `}>
                                                        <i className={`ph-fill ${log.val === 'Happy' ? 'ph-smiley' : log.val === 'Anxious' ? 'ph-lightning' : log.val === 'Low' ? 'ph-smiley-sad' : 'ph-smiley-meh'}`}></i>
                                                    </div>
                                                    <div>
                                                        <span className="font-bold text-slate-700 block text-sm leading-tight">{log.val}</span>
                                                        <span className="text-[10px] font-medium text-slate-400">Logged via App</span>
                                                    </div>
                                                </div>
                                                <span className="text-xs font-bold text-slate-500 bg-slate-50 px-2 py-1 rounded-lg border border-slate-100">{log.time}</span>
                                            </div>
                                        ))
                                    ) : (
                                        <div className="flex flex-col items-center justify-center h-full text-slate-400 opacity-60">
                                            <i className="ph-duotone ph-clock text-3xl mb-2"></i>
                                            <p className="text-sm font-medium">No activity recorded yet.</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 2. GRATITUDE JOURNAL (READ ONLY) */}
                    <div className="bg-gradient-to-r from-orange-50 to-amber-50 p-8 rounded-[2rem] border border-orange-100">
                        <div className="flex items-center gap-4 mb-8">
                            <div className="w-14 h-14 bg-white text-orange-500 rounded-2xl shadow-sm flex items-center justify-center border border-orange-100 text-2xl"><i className="ph-fill ph-book-open-text"></i></div>
                            <div>
                                <h3 className="font-bold text-2xl text-orange-900">Gratitude Entries</h3>
                                <p className="text-sm text-orange-800/60 font-medium">Read what the senior is thankful for today.</p>
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {wellnessLogs.filter(l => l.type === 'gratitude').length === 0 ? (
                                <div className="col-span-3 text-center py-10 opacity-50"><i className="ph-duotone ph-notebook text-4xl mb-2 text-orange-300"></i><p className="text-orange-800">Journal is empty.</p></div>
                            ) : (
                                wellnessLogs.filter(l => l.type === 'gratitude').slice(0, 3).map(l => (
                                    <div key={l.id} className="bg-white p-6 rounded-3xl border border-orange-100/50 shadow-sm relative flex flex-col justify-between min-h-[140px]">
                                        <div>
                                            <i className="ph-fill ph-quotes text-orange-200 text-3xl mb-2 block"></i>
                                            <p className="text-slate-700 text-base font-medium leading-relaxed line-clamp-3">"{l.text}"</p>
                                        </div>
                                        <div className="flex justify-between items-end mt-4 pt-4 border-t border-slate-50">
                                            <span className="text-[10px] font-bold text-orange-400 uppercase tracking-wider">{l.date} â€¢ {l.time}</span>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            ) : (
                // =========================================================
                // SENIOR VIEW: INTERACTIVE TOOLS
                // =========================================================
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    
                    {/* 1. MOOD CHECK-IN */}
                    <div className="bg-white/80 backdrop-blur-xl p-8 rounded-[2rem] shadow-xl border border-white/50 flex flex-col h-[520px] relative overflow-hidden">
                        <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-pink-200 to-purple-200 rounded-bl-[100px] opacity-20 -z-10"></div>
                        <div className="shrink-0 mb-6">
                            <h3 className="text-lg font-bold text-slate-700 mb-6 flex items-center gap-2">
                                <i className="ph-fill ph-heartbeat text-rose-500 text-xl"></i> How is your spirit today?
                            </h3>
                            <div className="flex justify-between gap-3">
                                {moods.map((m) => (
                                    <button key={m.label} onClick={() => logMood(m.label)} className="flex flex-col items-center gap-3 group">
                                        <div className={`w-16 h-16 rounded-2xl flex items-center justify-center text-3xl text-white shadow-lg bg-gradient-to-br ${m.color} ${m.shadow} transition-all duration-300 transform ${mood === m.label ? 'scale-110 ring-4 ring-offset-2 ring-blue-100 -translate-y-2' : 'group-hover:-translate-y-1 group-hover:shadow-xl'}`}>
                                            <i className={`ph-fill ${m.icon}`}></i>
                                        </div>
                                        <span className={`text-xs font-bold transition-colors ${mood === m.label ? 'text-blue-600' : 'text-slate-400 group-hover:text-slate-600'}`}>{m.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                        {mood ? (
                            <div className="flex-1 flex flex-col min-h-0 border-t border-slate-100 pt-6 fade-in">
                                <div className="flex justify-between items-center mb-4 shrink-0">
                                    <h4 className="text-xs font-bold text-slate-400 uppercase tracking-widest">Selected for You</h4>
                                    {!isAddingVideo && <button onClick={() => setIsAddingVideo(true)} className="flex items-center gap-1 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 px-3 py-1.5 rounded-full transition"><i className="ph-bold ph-plus"></i> Add Video</button>}
                                </div>
                                {isAddingVideo && (
                                    <div className="bg-slate-50 p-4 rounded-2xl mb-4 border border-blue-100 slide-up shrink-0 shadow-inner">
                                        <input className="w-full p-3 mb-3 rounded-xl border-none shadow-sm text-sm focus:ring-2 focus:ring-blue-200" placeholder="Title" value={newVideo.title} onChange={e => setNewVideo({...newVideo, title: e.target.value})} />
                                        <input className="w-full p-3 mb-3 rounded-xl border-none shadow-sm text-sm focus:ring-2 focus:ring-blue-200" placeholder="Paste YouTube Link" value={newVideo.link} onChange={e => setNewVideo({...newVideo, link: e.target.value})} />
                                        <div className="flex gap-2">
                                            <button onClick={handleAddVideo} className="flex-1 bg-blue-600 text-white py-2 rounded-xl text-sm font-bold">Save</button>
                                            <button onClick={() => setIsAddingVideo(false)} className="px-4 py-2 text-slate-500 text-sm font-bold bg-slate-200 rounded-xl">Cancel</button>
                                        </div>
                                    </div>
                                )}
                                <div className="overflow-y-auto custom-scroll pr-2 flex-1 space-y-3 pb-2">
                                    {library[mood].map((item, idx) => (
                                        <a key={idx} href={item.link} target="_blank" rel="noopener noreferrer" className="block w-full group relative">
                                            <div className={`flex items-center gap-4 p-4 rounded-2xl bg-white border border-slate-50 hover:border-blue-100 shadow-sm hover:shadow-md transition-all duration-300 relative z-10 ${item.isCustom ? 'bg-gradient-to-r from-rose-50/50 to-white' : ''}`}>
                                                <div className={`w-12 h-12 rounded-2xl flex items-center justify-center text-2xl shrink-0 ${item.color || 'bg-blue-50 text-blue-600'} shadow-sm group-hover:scale-110 transition-transform`}>
                                                    <i className={`ph-fill ${item.icon || 'ph-play-circle'}`}></i>
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <h5 className="font-bold text-slate-700 text-sm group-hover:text-blue-700 truncate transition-colors">{item.title}</h5>
                                                    <div className="flex items-center gap-2 mt-1">
                                                        <span className="text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-0.5 rounded-md">{item.type}</span>
                                                        <span className="text-[10px] text-slate-400">{item.dur}</span>
                                                    </div>
                                                </div>
                                                <button onClick={(e) => deleteVideo(item, mood, e)} className="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 hover:text-red-500 hover:bg-red-50 transition-all opacity-0 group-hover:opacity-100" title="Remove">
                                                    <i className="ph-bold ph-trash"></i>
                                                </button>
                                                <i className="ph-fill ph-play-circle text-3xl text-slate-200 group-hover:text-blue-500 transition-colors absolute right-4 top-1/2 -translate-y-1/2 opacity-100 group-hover:opacity-0"></i>
                                            </div>
                                        </a>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center text-center opacity-50 pb-10"><i className="ph-fill ph-hand-tap text-4xl mb-2 text-slate-300"></i><p className="text-slate-400 font-medium">Select a mood above</p></div>
                        )}
                    </div>

                    {/* 2. BREATHING */}
                    <div className={`rounded-[2rem] p-8 shadow-2xl flex flex-col items-center justify-center relative overflow-hidden h-[520px] transition-all duration-1000 bg-gradient-to-br ${breathColors[breathPhase]}`}>
                        <div className={`w-64 h-64 rounded-full border-8 border-white/20 flex flex-col items-center justify-center mb-10 transition-all duration-[4000ms] ease-in-out relative backdrop-blur-sm bg-white/5 ${breathPhase === 'inhale' || breathPhase === 'hold' ? 'scale-110 border-white/40' : 'scale-90'}`}>
                            <span className="text-4xl font-bold tracking-widest text-white drop-shadow-lg text-center leading-tight">{breathText}</span>
                        </div>
                        <button onClick={() => setBreathingActive(!breathingActive)} className="bg-white text-slate-800 px-12 py-4 rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all active:scale-95 flex items-center gap-3 text-lg">
                            {breathingActive ? <><i className="ph-fill ph-stop-circle text-red-500"></i> Stop</> : <><i className="ph-fill ph-play-circle text-green-500"></i> Start Session</>}
                        </button>
                    </div>

                    {/* 3. GRATITUDE JOURNAL (WRITE MODE) */}
                    <div className="lg:col-span-2 bg-gradient-to-r from-orange-50 to-amber-50 p-8 rounded-[2rem] border border-orange-100">
                        <div className="flex items-center gap-4 mb-8">
                            <div className="w-14 h-14 bg-white text-orange-500 rounded-2xl shadow-sm flex items-center justify-center border border-orange-100 text-2xl"><i className="ph-fill ph-book-open-text"></i></div>
                            <div><h3 className="font-bold text-2xl text-orange-900">Gratitude Timeline</h3><p className="text-sm text-orange-800/60 font-medium">Capture the good moments.</p></div>
                        </div>
                        <div className="bg-white p-2 pl-6 rounded-2xl shadow-sm border border-orange-100 flex gap-4 mb-10 focus-within:ring-4 focus-within:ring-orange-100 transition-all items-center">
                            <i className="ph-bold ph-pencil-simple text-orange-300 text-xl"></i>
                            <textarea value={gratitudeInput} onChange={e => setGratitudeInput(e.target.value)} placeholder="What made you smile today?" rows="1" className="flex-1 py-4 bg-transparent border-none outline-none text-slate-700 resize-none placeholder:text-slate-400 font-medium text-lg"></textarea>
                            <button onClick={saveGratitude} className="bg-gradient-to-br from-orange-400 to-amber-500 text-white w-12 h-12 rounded-xl flex items-center justify-center shadow-md hover:shadow-lg hover:scale-105 transition shrink-0"><i className="ph-bold ph-paper-plane-right text-xl"></i></button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {wellnessLogs.filter(l => l.type === 'gratitude').slice(0, 3).map(l => (
                                <div key={l.id} className="bg-white p-6 rounded-3xl border border-orange-100/50 shadow-sm flex flex-col justify-between min-h-[140px]">
                                    <div><i className="ph-fill ph-quotes text-orange-200 text-3xl mb-2 block"></i><p className="text-slate-700 font-medium line-clamp-3">{l.text}</p></div>
                                    <div className="flex justify-between items-end mt-4 pt-4 border-t border-slate-50"><span className="text-[10px] font-bold text-orange-400 uppercase tracking-wider">{l.date}</span></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};
        // --- NEW FEATURE: HEALTH INSURANCE VAULT ---
        const InsuranceTab = ({ data, refreshData }) => {
            const [uploading, setUploading] = useState(false);
            const fileInputRef = useRef(null);

            // Ensure insuranceDocs array exists
            const myPolicies = data.insuranceDocs || [];

            // --- FILE UPLOAD LOGIC (Safe Mode < 500KB) ---
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (file.size > 500000) {
                    alert("âš ï¸ File too large! Please upload a file smaller than 500KB.");
                    return;
                }

                setUploading(true);
                const reader = new FileReader();
                reader.onload = (event) => {
                    const newDoc = {
                        id: Date.now(),
                        name: file.name,
                        date: new Date().toLocaleDateString(),
                        content: event.target.result, // Data URL
                        type: file.type.includes('image') ? 'Image' : 'PDF'
                    };

                    const currentData = MockBackend.getData();
                    const updatedDocs = [newDoc, ...(currentData.insuranceDocs || [])];
                    MockBackend.updateData({ ...currentData, insuranceDocs: updatedDocs });
                    
                    setUploading(false);
                    refreshData();
                    alert("Policy Document Saved!");
                };
                reader.readAsDataURL(file);
            };

            const deletePolicy = (id) => {
                if(confirm("Delete this document permanently?")) {
                    const currentData = MockBackend.getData();
                    const updatedDocs = currentData.insuranceDocs.filter(d => d.id !== id);
                    MockBackend.updateData({ ...currentData, insuranceDocs: updatedDocs });
                    refreshData();
                }
            };

            // --- PRIVATE INSURERS LINKS ---
            const insurers = [
                { name: "Star Health", url: "https://www.starhealth.in/", color: "bg-blue-50 text-blue-700 border-blue-200", icon: "ph-star" },
                { name: "HDFC Ergo", url: "https://www.hdfcergo.com/health-insurance", color: "bg-red-50 text-red-700 border-red-200", icon: "ph-shield" },
                { name: "Niva Bupa", url: "https://www.nivabupa.com/", color: "bg-green-50 text-green-700 border-green-200", icon: "ph-first-aid" },
                { name: "ICICI Lombard", url: "https://www.icicilombard.com/health-insurance", color: "bg-purple-50 text-purple-700 border-purple-200", icon: "ph-umbrella" },
            ];

            return (
                <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
                    
                    {/* HEADER */}
                    <div className="flex items-center gap-4">
                        <div className="w-16 h-16 rounded-2xl bg-indigo-100 flex items-center justify-center text-indigo-600 shadow-sm">
                            <i className="ph-fill ph-file-lock text-3xl"></i>
                        </div>
                        <div>
                            <h1 className="text-2xl font-bold text-slate-800">Insurance Vault</h1>
                            <p className="text-slate-500">Secure your policies & access benefits</p>
                        </div>
                    </div>

                    {/* 1. MY POLICY UPLOAD SECTION */}
                    <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                <i className="ph-fill ph-files text-indigo-500"></i> My Policies
                            </h3>
                            <button 
                                onClick={() => fileInputRef.current.click()}
                                className="bg-indigo-600 text-white px-4 py-2 rounded-xl font-bold text-sm shadow-md hover:bg-indigo-700 transition flex items-center gap-2"
                            >
                                <i className="ph-bold ph-upload-simple"></i> Upload Policy
                            </button>
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                className="hidden" 
                                accept="image/*,application/pdf"
                                onChange={handleFileUpload}
                            />
                        </div>

                        {uploading && <div className="text-center text-sm text-indigo-500 animate-pulse mb-4">Uploading secure document...</div>}

                        {/* LIST OF UPLOADED POLICIES */}
                        <div className="grid gap-3">
                            {myPolicies.length === 0 ? (
                                <div className="text-center p-8 border-2 border-dashed border-slate-200 rounded-2xl bg-slate-50">
                                    <i className="ph-duotone ph-file-plus text-3xl text-slate-400 mb-2"></i>
                                    <p className="text-sm text-slate-500">No policies uploaded yet.<br/>Keep your documents safe here.</p>
                                </div>
                            ) : (
                                myPolicies.map((doc) => (
                                    <div key={doc.id} className="flex items-center justify-between p-4 bg-slate-50 border border-slate-100 rounded-xl hover:shadow-md transition group">
                                        <div className="flex items-center gap-4">
                                            <div className="w-10 h-10 rounded-lg bg-white flex items-center justify-center text-slate-500 shadow-sm">
                                                <i className={`ph-fill ${doc.type === 'Image' ? 'ph-image' : 'ph-file-pdf'}`}></i>
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-slate-700 text-sm">{doc.name}</h4>
                                                <p className="text-xs text-slate-400">Added: {doc.date}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            {doc.type === 'Image' && (
                                                <a href={doc.content} download={doc.name} className="w-8 h-8 flex items-center justify-center rounded-full bg-white text-blue-500 shadow-sm hover:bg-blue-50 transition" title="Download">
                                                    <i className="ph-bold ph-download-simple"></i>
                                                </a>
                                            )}
                                            <button onClick={() => deletePolicy(doc.id)} className="w-8 h-8 flex items-center justify-center rounded-full bg-white text-red-400 shadow-sm hover:bg-red-50 transition" title="Delete">
                                                <i className="ph-bold ph-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>

                    {/* 2. PMJAY HERO CARD (GOLD) */}
                    <div className="relative overflow-hidden rounded-3xl bg-gradient-to-r from-yellow-50 to-amber-100 border border-amber-200 p-1 shadow-lg transform hover:scale-[1.01] transition-transform duration-300">
                        <div className="absolute top-0 right-0 w-64 h-64 bg-yellow-400 opacity-10 rounded-full -mr-10 -mt-10 blur-3xl"></div>
                        
                        <div className="bg-white/40 backdrop-blur-md rounded-[20px] p-6 sm:p-8 flex flex-col md:flex-row items-center gap-8 relative z-10">
                            <div className="flex-1 text-center md:text-left">
                                <div className="inline-flex items-center gap-2 bg-amber-200/50 text-amber-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-3 border border-amber-300/50">
                                    <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Government Scheme
                                </div>
                                <h2 className="text-3xl font-extrabold text-slate-800 mb-2">Ayushman Bharat (PM-JAY)</h2>
                                <p className="text-slate-600 mb-6 font-medium">
                                    Get cashless treatment up to <span className="text-amber-700 font-black text-lg">â‚¹5 Lakhs</span> per family per year for secondary and tertiary care hospitalization.
                                </p>
                                <div className="flex flex-wrap gap-3 justify-center md:justify-start">
                                    <a href="https://pmjay.gov.in/" target="_blank" className="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-slate-800 transition flex items-center gap-2">
                                        Check Eligibility <i className="ph-bold ph-arrow-up-right"></i>
                                    </a>
                                    <a href="https://beneficiary.nha.gov.in/" target="_blank" className="bg-white text-slate-800 px-6 py-3 rounded-xl font-bold shadow-sm hover:bg-amber-50 transition border border-amber-200">
                                        Download Card
                                    </a>
                                </div>
                            </div>
                            
                            {/* Decorative Badge */}
                            <div className="w-40 h-40 bg-gradient-to-br from-yellow-300 to-amber-500 rounded-full flex flex-col items-center justify-center text-white shadow-xl border-4 border-white/50 shrink-0 rotate-3 hover:rotate-0 transition-transform">
                                <span className="text-sm font-bold opacity-90">Cover</span>
                                <span className="text-4xl font-black">â‚¹5L</span>
                                <span className="text-xs font-bold bg-black/20 px-2 py-0.5 rounded mt-1">FREE</span>
                            </div>
                        </div>
                    </div>

                    {/* 3. TOP PROVIDERS GRID (Innovative UI) */}
                    <div>
                        <div className="flex items-center justify-between mb-6">
                            <h3 className="font-bold text-slate-700 flex items-center gap-2 text-lg">
                                <span className="w-8 h-8 rounded-lg bg-indigo-100 flex items-center justify-center text-indigo-600"><i className="ph-fill ph-shield-check"></i></span>
                                Trusted Partners
                            </h3>
                            <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">Verified Links</span>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            {insurers.map((ins) => (
                                <a 
                                    key={ins.name} 
                                    href={ins.url} 
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className={`group relative p-6 rounded-[24px] border border-white/50 bg-white shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all duration-300 overflow-hidden flex flex-col justify-between h-48`}
                                >
                                    {/* Decorative Background Blob */}
                                    <div className={`absolute -top-10 -right-10 w-32 h-32 rounded-full opacity-10 transition-transform group-hover:scale-150 duration-500 ${ins.color.replace('text-', 'bg-').split(' ')[1]}`}></div>

                                    {/* Icon & Badge */}
                                    <div className="flex justify-between items-start relative z-10">
                                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center text-3xl ${ins.color} shadow-sm group-hover:scale-110 transition-transform duration-300`}>
                                            <i className={`ph-fill ${ins.icon}`}></i>
                                        </div>
                                        <div className="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 group-hover:text-indigo-600 group-hover:bg-indigo-50 transition-colors">
                                            <i className="ph-bold ph-arrow-up-right"></i>
                                        </div>
                                    </div>

                                    {/* Text Content */}
                                    <div className="relative z-10">
                                        <h4 className="font-bold text-slate-800 text-lg leading-tight mb-1 group-hover:text-indigo-900 transition-colors">{ins.name}</h4>
                                        <p className="text-xs text-slate-400 font-medium group-hover:text-slate-500 flex items-center gap-1">
                                            Official Portal 
                                            <span className="w-0 overflow-hidden group-hover:w-4 transition-all duration-300 inline-flex"><i className="ph-bold ph-arrow-right ml-1"></i></span>
                                        </p>
                                    </div>
                                    
                                    {/* Bottom Stripe */}
                                    <div className={`absolute bottom-0 left-0 w-full h-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300 ${ins.color.replace('text-', 'bg-').split(' ')[1]}`}></div>
                                </a>
                            ))}
                        </div>
                    </div>

                </div>
            );
        };
       // --- LAYOUT COMPONENTS ---
const Sidebar = ({ activeTab, setTab, onLogout, user, isOpen, closeMenu }) => {
    const classes = isOpen 
        ? "absolute inset-y-0 left-0 z-40 w-64 bg-white border-r shadow-2xl transform translate-x-0 transition-transform duration-300" 
        : "absolute inset-y-0 left-0 z-40 w-64 bg-white border-r shadow-xl transform -translate-x-full transition-transform duration-300 md:static md:translate-x-0";
    
    return (
        <>
            {isOpen && <div onClick={closeMenu} className="fixed inset-0 bg-black/40 z-30 md:hidden backdrop-blur-sm"></div>}
            <aside className={classes + " flex flex-col h-full"}>
                <div className="p-6 border-b flex items-center justify-between">
                    <div className="flex items-center gap-2 text-blue-900 font-bold text-xl tracking-tight">
                        <img src={LOGO_SRC} alt="Logo" className="w-10 h-10 rounded-full" />
                        SUSHRUTA
                    </div>
                    <button onClick={closeMenu} className="md:hidden text-slate-400"><i className="ph-bold ph-x text-xl"></i></button>
                </div>
                <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                    {[ 
                        { id: 'home', icon: 'ph-squares-four', label: 'Dashboard' }, 
                        { id: 'assistant', icon: 'ph-robot', label: 'AI Assistant' },
                        { id: 'gps', icon: 'ph-map-pin', label: 'Live Location' },
                        { id: 'meds', icon: 'ph-pill', label: 'Medicines' },
                        { id: 'wellness', icon: 'ph-plant', label: 'Wellness & Diet' },
                        { id: 'joy', icon: 'ph-heart', label: 'Emotional Wellbeing' },
                        { id: 'reports', icon: 'ph-chart-bar', label: 'Reports' },
                        { id: 'appointments', icon: 'ph-stethoscope', label: user?.role === 'doctor' ? 'Patient Requests' : 'Appointments' },
                        { id: 'insurance', icon: 'ph-shield-check', label: 'Insurance' },
                        { id: 'shop', icon: 'ph-shopping-cart', label: 'Buy Medicines' },
                        { id: 'gov', icon: 'ph-bank', label: 'Govt. Schemes' },
                        { id: 'profile', icon: 'ph-user-circle', label: 'My Profile' }
                    ]
                    // --- UPDATED FILTER: Hide multiple tabs for Doctors ---
                    .filter(item => {
                    // 1. Hide GPS from Seniors (They don't need to track themselves)
                        if (user?.role === 'senior' && item.id === 'gps') {
                            return false;
                        }
                        
                        // 2. Hide specific tabs from Doctors
                        if (user?.role === 'doctor') {
                            const hiddenTabs = ['wellness', 'joy', 'insurance', 'shop', 'gov', 'gps'];
                            return !hiddenTabs.includes(item.id);
                        }
                        
                        return true; 
                    })
                    .map(item => (
                        <button key={item.id} onClick={() => { setTab(item.id); closeMenu(); }} className={`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${activeTab === item.id ? 'bg-blue-50 text-blue-900 font-bold' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-900'}`}>
                            <i className={`ph-fill ${item.icon} text-xl`}></i> {item.label}
                        </button>
                    ))}
                </nav>
                <div className="p-4 border-t bg-slate-50 flex items-center gap-3">
                    <img src={user?.photo || "https://ui-avatars.com/api/?name=" + user.name} className="w-10 h-10 rounded-full border border-white shadow-sm object-cover" />
                    <div className="flex-1 cursor-pointer overflow-hidden" onClick={() => {setTab('profile'); closeMenu();}}>
                        <p className="text-sm font-bold text-slate-700 truncate">{user?.name}</p>
                        <p className="text-xs text-slate-400 capitalize">{user?.role}</p>
                    </div>
                    <button onClick={onLogout} className="text-red-400 hover:text-red-600 p-2 rounded-lg hover:bg-red-50"><i className="ph-bold ph-sign-out text-xl"></i></button>
                </div>
            </aside>
        </>
    );
};

        const RightPanel = ({ reminders, isOpen, closeMenu, onAddReminder, onDeleteReminder }) => {
            const classes = isOpen 
                ? "absolute inset-y-0 right-0 z-40 w-80 bg-white border-l shadow-2xl transform translate-x-0 transition-transform duration-300" 
                : "absolute inset-y-0 right-0 z-40 w-80 bg-white border-l shadow-xl transform translate-x-full transition-transform duration-300 lg:static lg:translate-x-0";
            
            const [selectedDay, setSelectedDay] = useState(new Date().getDate());
            const [newEvent, setNewEvent] = useState('');
            const [hour, setHour] = useState('09');
            const [minute, setMinute] = useState('00');
            const [period, setPeriod] = useState('AM');
            const [selectedReminderId, setSelectedReminderId] = useState(null);

            const parseTime = (timeStr) => {
                const [time, modifier] = timeStr.split(' ');
                let [hours, minutes] = time.split(':');
                if (hours === '12') hours = '00';
                if (modifier === 'PM') hours = parseInt(hours, 10) + 12;
                return parseInt(hours, 10) * 60 + parseInt(minutes, 10);
            };

            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const startDay = new Date(now.getFullYear(), now.getMonth(), 1).getDay();
            const totalSlots = [...Array(startDay).fill(null), ...[...Array(daysInMonth)].map((_, i) => i + 1)];

            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            const daysReminders = reminders.filter(r => r.day === selectedDay);
            const waterReminders = daysReminders.filter(r => r.text === "Drink Water");
            const otherReminders = daysReminders.filter(r => r.text !== "Drink Water");

            let nextWaterReminder = null;
            if (selectedDay === now.getDate()) {
                 nextWaterReminder = waterReminders.find(r => parseTime(r.time) > currentMinutes && !r.completed);
            } else if (selectedDay > now.getDate()) {
                 nextWaterReminder = waterReminders[0]; 
            }
            
            let filteredReminders = [...otherReminders];
            if (nextWaterReminder) {
                filteredReminders.push(nextWaterReminder);
            }

            filteredReminders.sort((a, b) => {
                if (a.completed === b.completed) {
                    return parseTime(a.time) - parseTime(b.time);
                }
                return a.completed ? 1 : -1;
            });
            
            const monthName = now.toLocaleString('default', { month: 'long' });

            const handleAdd = () => {
                if(newEvent && hour && minute) {
                    const timeStr = `${hour.toString().padStart(2,'0')}:${minute.toString().padStart(2,'0')} ${period}`;
                    onAddReminder(newEvent, timeStr, selectedDay);
                    setNewEvent('');
                }
            }

            const handleDelete = () => {
                if (selectedReminderId) {
                    onDeleteReminder(selectedReminderId);
                    setSelectedReminderId(null); 
                }
            }

            return (
                <>
                    {isOpen && <div onClick={closeMenu} className="fixed inset-0 bg-black/40 z-30 lg:hidden backdrop-blur-sm"></div>}
                    <aside className={classes + " flex flex-col h-full"}>
                        <div className="p-4 border-b flex justify-between items-center lg:hidden">
                            <h3 className="font-bold text-slate-800">Schedule</h3>
                            <button onClick={closeMenu}><i className="ph-bold ph-x text-xl"></i></button>
                        </div>
                        <div className="p-6 overflow-y-auto h-full space-y-6">
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                        <i className="ph-bold ph-calendar-blank text-blue-600"></i> 
                                        {monthName} {now.getFullYear()}
                                    </h3>
                                    <span className="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded">Today: {now.getDate()}</span>
                                </div>
                                <div className="grid grid-cols-7 gap-1 text-center text-xs font-medium text-slate-500">
                                    {['S','M','T','W','T','F','S'].map(d => <span key={d}>{d}</span>)}
                                    {totalSlots.map((d, i) => {
                                        if (d === null) return <span key={i}></span>;
                                        const isSelected = d === selectedDay;
                                        const isToday = d === now.getDate();
                                        return (
                                            <span 
                                                key={i} 
                                                onClick={() => setSelectedDay(d)}
                                                className={`p-2 rounded-lg cursor-pointer transition relative
                                                    ${isSelected ? 'bg-blue-600 text-white font-bold shadow-md' : 'hover:bg-slate-100'}
                                                    ${isToday && !isSelected ? 'text-blue-600 font-bold border border-blue-200' : ''}
                                                `}
                                            >
                                                {d}
                                                {isToday && !isSelected && <span className="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-blue-600 rounded-full"></span>}
                                            </span>
                                        );
                                    })}
                                </div>
                            </div>
                            
                            {/* ADD REMINDER FORM */}
                            <div className="bg-slate-50 rounded-2xl p-4 border border-slate-200">
                                <h4 className="text-sm font-bold text-slate-600 mb-2">Create Reminder for Day {selectedDay}</h4>
                                <div className="space-y-4">
                                    <div className="relative">
                                        <i className="ph-bold ph-pencil-simple absolute left-3 top-3 text-slate-400"></i>
                                        <input 
                                            value={newEvent} 
                                            onChange={e=>setNewEvent(e.target.value)} 
                                            placeholder="Task Name (e.g. Yoga)" 
                                            className="w-full pl-10 p-2.5 text-sm bg-slate-50 rounded-xl border border-slate-200 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all" 
                                        />
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <input
                                            type="number"
                                            value={hour}
                                            onChange={e => setHour(e.target.value)}
                                            placeholder="HH"
                                            className="w-full bg-white border border-slate-200 text-slate-700 text-sm font-bold py-2 px-3 rounded-xl outline-none focus:border-blue-500 text-center no-spinner"
                                            maxLength="2"
                                        />
                                        <span className="text-slate-400 font-bold">:</span>
                                        <input
                                            type="number"
                                            value={minute}
                                            onChange={e => setMinute(e.target.value)}
                                            placeholder="MM"
                                            className="w-full bg-white border border-slate-200 text-slate-700 text-sm font-bold py-2 px-3 rounded-xl outline-none focus:border-blue-500 text-center no-spinner"
                                            maxLength="2"
                                        />
                                        <div className="flex bg-slate-200 rounded-xl p-1 gap-1">
                                            <button onClick={()=>setPeriod('AM')} className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${period==='AM' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>AM</button>
                                            <button onClick={()=>setPeriod('PM')} className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${period==='PM' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>PM</button>
                                        </div>
                                    </div>
                                    <button onClick={handleAdd} className="w-full bg-blue-900 text-white py-2.5 rounded-xl font-bold text-sm shadow-md hover:bg-blue-800 transition flex justify-center items-center gap-2">
                                        Add to Schedule <i className="ph-bold ph-plus"></i>
                                    </button>
                                </div>
                            </div>

                            <div className="bg-blue-50/50 rounded-2xl p-5 border border-blue-100">
                                <h3 className="font-bold text-blue-900 mb-4 flex items-center gap-2"><i className="ph-fill ph-bell-ringing"></i> Schedule ({selectedDay}th)</h3>
                                <div className="space-y-3 max-h-[300px] overflow-y-auto custom-scroll pr-2">
                                    {filteredReminders.map((r, i) => (
                                        <div 
                                            key={i} 
                                            onClick={() => setSelectedReminderId(r.id === selectedReminderId ? null : r.id)}
                                            className={`flex gap-3 bg-white p-3 rounded-xl shadow-sm border items-center fade-in cursor-pointer transition-all
                                                ${r.completed ? 'opacity-50 border-slate-100 bg-slate-50' : 'border-slate-100'}
                                                ${r.id === selectedReminderId ? 'ring-2 ring-red-400 bg-red-50' : 'hover:border-blue-200'}
                                            `}
                                        >
                                            <div className={`p-2 rounded-full ${r.completed ? 'bg-green-100 text-green-600' : (r.text === "Drink Water" ? 'bg-blue-100 text-blue-500' : 'bg-orange-100 text-orange-600')}`}>
                                                <i className={`ph-bold ${r.completed ? 'ph-check' : (r.text === "Drink Water" ? 'ph-drop' : 'ph-clock')}`}></i>
                                            </div>
                                            <div className="flex-1">
                                                <p className={`text-sm font-bold ${r.completed ? 'line-through text-slate-400' : 'text-slate-800'}`}>{r.text}</p>
                                                <p className="text-xs text-slate-500">{r.time}</p>
                                            </div>
                                            {r.id === selectedReminderId && <i className="ph-bold ph-check-circle text-red-500 text-xl"></i>}
                                        </div>
                                    ))}
                                    {filteredReminders.length === 0 && <p className="text-xs text-center text-slate-400">No reminders for this day</p>}
                                </div>
                                {selectedReminderId && (
                                    <button 
                                        onClick={handleDelete}
                                        className="w-full mt-4 py-2 bg-red-100 text-red-600 font-bold rounded-xl hover:bg-red-200 transition flex items-center justify-center gap-2 fade-in"
                                    >
                                        <i className="ph-bold ph-trash"></i> Delete Selected
                                    </button>
                                )}
                            </div>
                        </div>
                    </aside>
                </>
            );
        };
        
        // --- 1. HEALTH SCORE CARD COMPONENT ---
const HealthScoreCard = ({ data, refreshData, onShowHistory, setLiveScore, userRole }) => {
    const [score, setScore] = useState(0);
    const [breakdown, setBreakdown] = useState({});
    
    // Role Logic for Score Card
    const role = (userRole || '').toLowerCase();
    const isDoctor = role === 'doctor';

    // THE CORE SCORE ALGORITHM
    useEffect(() => {
        let tempScore = 0;
        let log = {};

        // 1. Medicine Adherence (30 Points)
        const dailyMeds = data.meds.filter(m => m.category === 'Daily Routine');
        if (dailyMeds.length > 0) {
            const taken = dailyMeds.filter(m => m.taken).length;
            const medScore = (taken / dailyMeds.length) * 30;
            tempScore += medScore;
            log.meds = { val: `${taken}/${dailyMeds.length}`, pts: medScore.toFixed(0) };
        } else {
            tempScore += 30;
            log.meds = { val: "N/A", pts: 30 };
        }

        // 2. Blood Pressure (20 Points)
        const [sys, dia] = data.vitals.bp.split('/').map(Number);
        let bpPoints = 20;
        if (sys > 140 || dia > 90) bpPoints = 5; 
        else if (sys > 130 || dia > 80) bpPoints = 10;
        else if (sys > 120) bpPoints = 15;
        tempScore += bpPoints;
        log.bp = { val: data.vitals.bp, pts: bpPoints };

        // 3. Heart Rate (10 Points)
        const hr = data.vitals.heartRate;
        let hrPoints = (hr >= 60 && hr <= 100) ? 10 : 5;
        tempScore += hrPoints;
        log.hr = { val: hr, pts: hrPoints };

        // 4. Sleep (15 Points)
        let sleepVal = (typeof data.vitals.sleep === 'object') ? data.vitals.sleep.value : parseFloat(data.vitals.sleep) || 0;
        let sleepPoints = (sleepVal >= 7) ? 15 : (sleepVal >= 5 ? 8 : 2);
        tempScore += sleepPoints;
        log.sleep = { val: sleepVal.toFixed(1) + 'h', pts: sleepPoints };

        // 5. Steps (15 Points)
        const steps = data.vitals.steps;
        let stepPoints = (steps > 5000) ? 15 : (steps > 2000 ? 8 : 2);
        tempScore += stepPoints;
        log.steps = { val: steps, pts: stepPoints };

        // 6. Exercise (10 Points)
        if (data.vitals.exercise) {
            tempScore += 10;
            log.ex = { val: "Yes", pts: 10 };
        } else {
            log.ex = { val: "No", pts: 0 };
        }

        const finalScore = Math.round(tempScore);
        setScore(finalScore);
        setBreakdown(log);
        if (setLiveScore) setLiveScore(finalScore);
    }, [data]);

    const toggleExercise = () => {
        const newData = {...data};
        newData.vitals.exercise = !newData.vitals.exercise;
        MockBackend.updateData(newData);
        refreshData();
    };

    const vitalsTotal = (parseInt(breakdown.bp?.pts||0) + parseInt(breakdown.hr?.pts||0));
    const sleepActivityTotal = (parseInt(breakdown.sleep?.pts||0) + parseInt(breakdown.steps?.pts||0));

    return (
        <div className="bg-white rounded-[20px] shadow-sm overflow-hidden relative p-6 border border-slate-100">
            
            {/* Background Decoration */}
            <div className="absolute -top-5 -right-5 w-36 h-36 opacity-5 pointer-events-none">
                <svg viewBox="0 0 24 24" className="w-full h-full fill-current text-blue-900">
                    <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>
                </svg>
            </div>

            {/* Header */}
            <div className="mb-6 relative z-10">
                <div className="text-xl text-blue-900 font-bold flex flex-col gap-1">
                    Daily Health Score
                    <span className="text-sm text-slate-500 font-normal">As per WHO</span>
                </div>
            </div>

            <div className="flex flex-col md:flex-row gap-8 items-center relative z-10">
                
                {/* Left: Circular UI with /100 label */}
                <div 
                    className="flex-none flex flex-col items-center justify-center w-40 cursor-pointer group"
                    onClick={onShowHistory}
                    title="Click to view Score History"
                >
                    <svg viewBox="0 0 36 36" className="circular-chart transition transform group-hover:scale-105">
                        <path className="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path 
                            className="circle" 
                            stroke={score < 50 ? '#ef4444' : score < 80 ? '#f59e0b' : '#10b981'} 
                            strokeDasharray={`${score}, 100`} 
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" 
                        />
                        <text x="18" y="19" className="percentage">{score}</text>
                        <text x="18" y="24" className="text-[3px] font-medium fill-slate-400" textAnchor="middle">/ 100</text>
                    </svg>

                    <div className="-mt-4 bg-emerald-50 text-emerald-700 px-4 py-1.5 rounded-full text-xs font-bold shadow-sm z-20 flex items-center gap-1 group-hover:bg-emerald-100 transition">
                        DAILY SCORE <i className="ph-bold ph-chart-line-up"></i>
                    </div>
                </div>

                {/* Right: Metrics Grid */}
                <div className="flex-1 grid grid-cols-2 gap-4 w-full">
                    {/* Meds */}
                    <div className="bg-slate-50 rounded-xl p-4 flex justify-between items-center transition hover:-translate-y-1 hover:bg-white hover:shadow-md border border-transparent hover:border-slate-200">
                        <div>
                            <h4 className="text-xs text-slate-500 mb-1">Meds Taken</h4>
                            <div className="text-base font-bold text-emerald-500">{breakdown.meds?.pts || 0}/30</div>
                        </div>
                    </div>

                    {/* Vitals */}
                    <div className="bg-slate-50 rounded-xl p-4 flex justify-between items-center transition hover:-translate-y-1 hover:bg-white hover:shadow-md border border-transparent hover:border-slate-200">
                        <div>
                            <h4 className="text-xs text-slate-500 mb-1">Vitals (BP/HR)</h4>
                            <div className="text-base font-bold text-blue-500">{vitalsTotal}/30</div>
                        </div>
                    </div>

                    {/* Sleep */}
                    <div className="bg-slate-50 rounded-xl p-4 flex justify-between items-center transition hover:-translate-y-1 hover:bg-white hover:shadow-md border border-transparent hover:border-slate-200">
                        <div>
                            <h4 className="text-xs text-slate-500 mb-1">Sleep & Activity</h4>
                            <div className="text-base font-bold text-purple-500">{sleepActivityTotal}/30</div>
                        </div>
                    </div>

                    {/* Exercise */}
                    <div className="bg-slate-50 rounded-xl p-4 flex justify-between items-center transition hover:-translate-y-1 hover:bg-white hover:shadow-md border border-transparent hover:border-slate-200">
                        <div>
                            <h4 className="text-xs text-slate-500 mb-1">Exercise</h4>
                            <div className="text-base font-bold text-orange-500">{breakdown.ex?.pts || 0}/10</div>
                        </div>
                    </div>
                </div>
            </div>
                 
            {/* Footer Banner - HIDDEN FOR DOCTOR */}
            {!isDoctor && (
                <div 
                    onClick={toggleExercise} 
                    className={`mt-6 rounded-lg p-3 text-center text-sm font-semibold flex items-center justify-center gap-2 cursor-pointer transition select-none 
                        ${data.vitals.exercise ? 'bg-emerald-50 text-emerald-700 border border-emerald-100' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}
                    `}
                >
                    <i className={`ph-fill ${data.vitals.exercise ? 'ph-check-circle' : 'ph-circle'}`}></i>
                    {data.vitals.exercise ? 'Exercise Recorded' : 'Mark Exercise as Done'}
                </div>
            )}
        </div>
    );
};

// --- 2. DASHBOARD CONTENT ---
const DashboardContent = ({ data, refreshData, user, setTab }) => { 
    const [connected, setConnected] = useState(false);
    const [syncing, setSyncing] = useState(false);
    const [selectedMetric, setSelectedMetric] = useState(null);
    const [sosStep, setSosStep] = useState(0); 
    const [editingMetric, setEditingMetric] = useState(null);
    const [activeAlert, setActiveAlert] = useState(null); 
    const [liveScore, setLiveScore] = useState(0); 

    // --- ROLE LOGIC ---
    const userRole = user?.role?.toLowerCase() || 'senior';
    const isDoctor = userRole === 'doctor'; 
    const isCareTeam = ['doctor', 'caretaker'].includes(userRole);

    // --- LIVE STATES ---
    const [liveSteps, setLiveSteps] = useState(data.vitals.steps);
    const [liveHeart, setLiveHeart] = useState(data.vitals.heartRate);
    const [liveBP, setLiveBP] = useState(data.vitals.bp);
    const [liveSleep, setLiveSleep] = useState(data.vitals.sleep);

    useEffect(() => {
        setLiveSteps(data.vitals.steps);
        setLiveHeart(data.vitals.heartRate);
        setLiveBP(data.vitals.bp);
        setLiveSleep(data.vitals.sleep);
    }, [data]);

    // Notification Logic
    useEffect(() => {
        const interval = setInterval(() => {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const formattedHours = hours % 12 || 12; 
            const formattedTime = `${formattedHours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')} ${ampm}`;
            
            const found = data.reminders.find(r => r.day === now.getDate() && r.time === formattedTime && !r.completed && !r.notified);
            if (found) setActiveAlert(found);

            const appts = data.appointments || [];
            const foundAppt = appts.find(a => {
                if (a.status !== 'Confirmed' || a.notified) return false;
                const [year, month, day] = a.date.split('-').map(Number);
                const [appHours, appMinutes] = a.time.split(':').map(Number);
                const apptDate = new Date(year, month - 1, day, appHours, appMinutes);
                const diff = apptDate - now;
                return diff > 0 && diff <= 3600000 && diff > 3540000; 
            });

            if (foundAppt) {
                alert(`ðŸ”” UPCOMING APPOINTMENT\n\nYou have an appointment with Dr. ${foundAppt.doctorName} at ${foundAppt.time} (in ~1 hour).`);
                const currentData = MockBackend.getData();
                const updatedAppts = currentData.appointments.map(ap => 
                    ap.id === foundAppt.id ? { ...ap, notified: true } : ap
                );
                MockBackend.updateData({ ...currentData, appointments: updatedAppts });
                refreshData();
            }
        }, 5000); 
        return () => clearInterval(interval);
    }, [data]);

    // Live Simulation
    useEffect(() => {
        let interval;
        if(connected) {
            interval = setInterval(() => {
                setLiveSteps(prev => {
                    const newVal = Number(prev) + Math.floor(Math.random() * 3);
                    const current = MockBackend.getData();
                    current.vitals.steps = newVal;
                    MockBackend.updateData(current);
                    return newVal;
                });
                setLiveHeart(prev => 70 + Math.floor(Math.random() * 5));
            }, 2000);
        }
        return () => clearInterval(interval);
    }, [connected]);

    const handleSync = () => {
        setSyncing(true);
        setTimeout(() => { setConnected(true); setSyncing(false); refreshData(); }, 1500);
    };

    const handleSOS = () => {
        if (sosStep === 0) { setSosStep(1); setTimeout(() => setSosStep(0), 3000); } 
        else { 
            const contacts = [];
            if(user.emergencyPrimary?.name) contacts.push(`${user.emergencyPrimary.name} (Family)`);
            if(user.caretaker?.name) contacts.push(`${user.caretaker.name} (Caretaker)`);
            if(user.doctor?.name) contacts.push(`${user.doctor.name} (Doctor)`);
            const contactList = contacts.length > 0 ? contacts.join(', ') : "Emergency Services";
            alert(`ðŸš¨ SOS ALERT SENT TO ALL CONTACTS!\n\nLocation: ${user.address}\n\nNotifying:\n${contactList}`);
            setSosStep(0); 
        }
    };

    const toggleMed = (id) => {
        const newMeds = data.meds.map(m => {
            if (m.id === id) {
                const isTaking = !m.taken;
                const newStock = typeof m.stock === 'number' ? (isTaking ? m.stock - 1 : m.stock + 1) : m.stock;
                return { ...m, taken: isTaking, stock: newStock };
            }
            return m;
        });
        MockBackend.updateData({ ...data, meds: newMeds });
        refreshData();
    };

    const completeReminder = () => {
        if(!activeAlert) return;
        const newReminders = data.reminders.map(r => r.id === activeAlert.id ? { ...r, completed: true } : r);
        MockBackend.updateData({ ...data, reminders: newReminders });
        refreshData();
        setActiveAlert(null);
    };

    const handleSaveManual = (val) => {
        if(val && editingMetric) {
            const newData = {...data};
            let key = '';
            let finalVal = val;
            let graphVal = parseInt(val, 10); 

            if(editingMetric.includes('Steps')) key = 'steps';
            else if(editingMetric.includes('BP')) { key = 'bp'; graphVal = parseInt(val.split('/')[0]); finalVal = val; }
            else if(editingMetric.includes('Sleep')) { key = 'sleep'; finalVal = val.display; graphVal = val.value; }
            else if(editingMetric.includes('Heart')) key = 'heartRate';

            if(key) {
                if(key === 'heartRate') newData.vitals.heartRate = graphVal;
                else if(key === 'steps') newData.vitals.steps = graphVal;
                else newData.vitals[key] = finalVal;
                
                MockBackend.updateData(newData);
                refreshData();
                
                if(key === 'steps') setLiveSteps(graphVal);
                if(key === 'heartRate') setLiveHeart(graphVal);
                if(key === 'bp') setLiveBP(finalVal);
                if(key === 'sleep') setLiveSleep(finalVal);
            }
            setEditingMetric(null);
        }
    };

    const getGraphValue = (metric) => {
        if (metric === 'Steps') return Number(liveSteps);
        if (metric === 'Heart Rate') return Number(liveHeart);
        if (metric.includes('Blood') || metric === 'BP') return parseInt(String(liveBP).split('/')[0]) || 0;
        if (metric === 'Sleep') return typeof liveSleep === 'object' ? liveSleep.value : parseFloat(String(liveSleep)) || 0;
        return 0;
    };

    const dailyMeds = data.meds.filter(m => m.category === 'Daily Routine').sort((a, b) => a.taken - b.taken);

    return (
        <div className="p-4 md:p-8 space-y-8 fade-in pb-32">
            {editingMetric && <ManualEntryModal metric={editingMetric} onClose={() => setEditingMetric(null)} onSave={handleSaveManual} />}
            {activeAlert && <NotificationAlert reminder={activeAlert} onComplete={completeReminder} onClose={() => setActiveAlert(null)} />}

            <div className="flex justify-between items-center mb-6 gap-4">
                <div>
                    <h1 className="text-2xl md:text-3xl font-bold text-slate-800">Namaste, {user.name.split(' ')[0]} ðŸ™</h1>
                    <p className="text-sm md:text-base text-slate-500">Here's your health summary.</p>
                </div>
                
                {/* CONNECT WATCH BUTTON: HIDE FOR CARETAKERS & DOCTORS */}
                {!isCareTeam && (
                    <button onClick={handleSync} className={`shrink-0 flex items-center justify-center gap-2 w-12 h-12 md:w-auto md:h-auto md:px-6 md:py-2.5 rounded-full font-bold shadow-md transition-all ${connected ? 'bg-emerald-100 text-emerald-700 border border-emerald-200' : 'bg-blue-600 text-white hover:bg-blue-700'} ${syncing ? 'animate-pulse' : ''}`}>
                        <i className={`ph-bold ${connected ? 'ph-bluetooth-connected' : 'ph-bluetooth'} text-xl`}></i> 
                        <span className="hidden md:inline">{syncing ? 'Syncing...' : connected ? 'Live Sync On' : 'Connect Watch'}</span>
                    </button>
                )}
            </div>

            {/* --- CONDITIONAL SOS / ALERT BLOCK --- */}
            {!isCareTeam ? (
                // SENIOR VIEW: SOS Button
                <div className={`p-6 rounded-2xl flex flex-col md:flex-row items-center justify-between shadow-lg transition-all duration-300 bg-gradient-to-r from-red-500 to-red-700 text-white sos-pulse`}>
                    <div className="flex items-center gap-4 mb-4 md:mb-0 w-full md:w-auto">
                        <div className="bg-white text-red-600 p-3 rounded-full shadow-lg shrink-0"><i className="ph-fill ph-siren text-3xl"></i></div>
                        <div>
                            <h3 className="font-bold text-lg leading-tight">{sosStep === 1 ? 'CONFIRM EMERGENCY?' : 'SOS EMERGENCY'}</h3>
                            <p className="text-white/80 text-sm">{sosStep === 1 ? 'Tap again immediately to alert contacts' : `Press in case of immediate assistance`}</p>
                        </div>
                    </div>
                    <button onClick={handleSOS} className={`w-full md:w-auto ${sosStep === 1 ? 'bg-white text-red-700 animate-bounce' : 'bg-white text-red-600'} px-8 py-3 rounded-full font-bold shadow-lg hover:bg-red-50 transition uppercase tracking-wider`}>
                        {sosStep === 1 ? 'YES, ALERT!' : 'ALERT'}
                    </button>
                </div>
            ) : (
                // CARETAKER/DOCTOR VIEW: Safety Status
                <div className="p-6 rounded-2xl flex flex-col md:flex-row items-center justify-between shadow-sm border border-slate-200 bg-white mb-6">
                    <div className="flex items-center gap-4">
                        <div className="bg-emerald-50 text-emerald-600 p-3 rounded-full shadow-sm shrink-0">
                            <i className="ph-fill ph-shield-check text-3xl"></i>
                        </div>
                        <div>
                            <h3 className="font-bold text-lg text-slate-800 leading-tight">Patient Safety Status</h3>
                            <p className="text-slate-500 text-sm">
                                Currently monitoring <span className="font-bold text-slate-700">{user.name || 'Senior'}</span>. No active alerts.
                            </p>
                        </div>
                    </div>
                    <div className="mt-4 md:mt-0 flex gap-2">
                        <span className="px-4 py-2 bg-slate-100 text-slate-500 rounded-lg text-xs font-bold uppercase tracking-wider">
                            Last Update: Just now
                        </span>
                    </div>
                </div>
            )}
            
            {/* --- HEALTH SCORE CARD --- */}
            <HealthScoreCard 
                data={data} 
                refreshData={refreshData} 
                onShowHistory={() => setSelectedMetric('Health Score')} 
                setLiveScore={setLiveScore}
                userRole={user?.role} 
            />

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                {/* 1. Steps Card */}
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 vital-card relative group">
                    <div className="absolute top-4 right-4 z-10">
                        {/* HIDE MANUAL INPUT FOR DOCTORS */}
                        {!isDoctor && (
                            <button onClick={() => setEditingMetric('Daily Steps')} className="text-slate-300 hover:text-blue-600 p-1"><i className="ph-bold ph-plus-circle text-2xl"></i></button>
                        )}
                    </div>
                    <div onClick={() => setSelectedMetric('Steps')}>
                        <div className="flex justify-between items-start mb-4"><div className="p-3 bg-teal-50 text-teal-600 rounded-xl"><i className="ph-fill ph-sneaker-move text-2xl"></i></div></div>
                        <h3 className="text-4xl font-bold text-slate-800">{liveSteps}</h3>
                        <p className="text-sm font-medium text-slate-500 mt-1">Daily Steps</p>
                        <div className="w-full bg-slate-100 h-2 rounded-full mt-4 overflow-hidden"><div className="bg-teal-500 h-full rounded-full transition-all duration-1000" style={{width: `${Math.min((liveSteps/data.vitals.target)*100, 100)}%`}}></div></div>
                    </div>
                </div>

                {/* 2. Heart Rate Card */}
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 vital-card relative">
                    <div className="absolute top-4 right-4 z-10 flex gap-3 items-center">
                        {connected && <span className="flex h-3 w-3 relative"><span className="animate-ping absolute inline-flex h-3 w-3 rounded-full bg-red-400 opacity-75"></span><span className="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span></span>}
                        {/* HIDE MANUAL INPUT FOR DOCTORS */}
                        {!isDoctor && (
                            <button onClick={(e) => {e.stopPropagation(); setEditingMetric('Heart Rate');}} className="text-slate-300 hover:text-blue-600 p-1"><i className="ph-bold ph-plus-circle text-2xl"></i></button>
                        )}
                    </div>
                    <div onClick={() => setSelectedMetric('Heart Rate')}>
                        <div className="flex justify-between items-start mb-4"><div className="p-3 bg-red-50 text-red-600 rounded-xl"><i className="ph-fill ph-heartbeat text-2xl"></i></div></div>
                        <h3 className="text-4xl font-bold text-slate-800 pr-8">{liveHeart} <span className="text-lg text-slate-400 font-medium">bpm</span></h3>
                        <p className="text-sm font-medium text-slate-500 mt-1">Heart Rate</p>
                    </div>
                </div>

                {/* 3. BP Card */}
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 vital-card relative">
                    <div className="absolute top-4 right-4 z-10">
                        {/* HIDE MANUAL INPUT FOR DOCTORS */}
                        {!isDoctor && (
                            <button onClick={() => setEditingMetric('BP')} className="text-slate-300 hover:text-blue-600 p-1"><i className="ph-bold ph-plus-circle text-2xl"></i></button>
                        )}
                    </div>
                    <div onClick={() => setSelectedMetric('BP')}>
                        <div className="p-3 bg-blue-50 text-blue-600 rounded-xl w-fit mb-4"><i className="ph-fill ph-drop text-2xl"></i></div>
                        <h3 className="text-4xl font-bold text-slate-800">{liveBP}</h3>
                        <p className="text-sm font-medium text-slate-500 mt-1">Blood Pressure</p>
                    </div>
                </div>

                {/* 4. Sleep Card */}
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 vital-card relative">
                    <div className="absolute top-4 right-4 z-10">
                        {/* HIDE MANUAL INPUT FOR DOCTORS */}
                        {!isDoctor && (
                            <button onClick={() => setEditingMetric('Sleep Duration')} className="text-slate-300 hover:text-blue-600 p-1"><i className="ph-bold ph-plus-circle text-2xl"></i></button>
                        )}
                    </div>
                    <div onClick={() => setSelectedMetric('Sleep')}>
                        <div className="p-3 bg-purple-50 text-purple-600 rounded-xl w-fit mb-4"><i className="ph-fill ph-moon-stars text-2xl"></i></div>
                        <h3 className="text-4xl font-bold text-slate-800">
                            {typeof liveSleep === 'object' ? liveSleep.display : liveSleep} 
                            {typeof liveSleep !== 'object' && <span className="text-lg text-slate-400 ml-1">h</span>}
                        </h3>
                        <p className="text-sm font-medium text-slate-500 mt-1">Sleep Duration</p>
                    </div>
                </div>
            </div>

            {/* --- MEDICATION TRACKER: HIDE FOR DOCTORS --- */}
            {!isDoctor && (
                <div className="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-slate-100">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="font-bold text-xl text-slate-800 flex items-center gap-2"><i className="ph-duotone ph-pill text-blue-600"></i> Daily Medication Tracker</h3>
                        <span onClick={() => setTab('meds')} className="text-xs text-blue-600 font-bold cursor-pointer hover:underline">View All & SOS</span>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {dailyMeds.map(m => (
                            <div key={m.id} className={`p-4 border rounded-2xl transition-all flex flex-row justify-between items-center gap-4 ${m.taken ? 'bg-slate-50 border-slate-200 opacity-75' : 'bg-white border-blue-100 hover:border-blue-300'}`}>
                                <div className="flex gap-3 items-center flex-1 min-w-0">
                                    <div className={`p-3 rounded-full shrink-0 ${m.taken ? 'bg-slate-200 text-slate-500' : 'bg-blue-100 text-blue-600'}`}>
                                        <i className={`ph-fill ${m.type === 'Syrup' ? 'ph-drop' : 'ph-pill'} text-xl`}></i>
                                    </div>
                                    <div className="flex flex-col gap-1 w-full">
                                        <p className={`font-bold text-lg leading-tight truncate ${m.taken ? 'line-through text-slate-400' : 'text-slate-800'}`}>{m.name}</p>
                                        <p className="text-xs text-slate-500">{m.dose} â€¢ {m.time || m.schedule}</p>
                                        <div className="flex flex-wrap gap-2 mt-1">
                                            {typeof m.stock === 'number' && <span className={`text-[10px] font-bold px-2 py-0.5 rounded ${m.stock < 5 ? 'bg-red-100 text-red-600' : 'bg-slate-100 text-slate-500'}`}>Stock: {m.stock}</span>}
                                            {m.expiry && <span className="text-[10px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded">Exp: {m.expiry}</span>}
                                        </div>
                                    </div>
                                </div>
                                <button onClick={() => toggleMed(m.id)} className={`px-4 py-2 rounded-xl font-bold text-sm transition shrink-0 ${m.taken ? 'bg-slate-200 text-slate-500' : 'bg-blue-600 text-white hover:bg-blue-700 shadow-md'}`}>
                                    {m.taken ? 'Taken' : 'Take'}
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {selectedMetric && <ChartModal 
                type={selectedMetric} 
                history={
                    selectedMetric === 'Health Score' ? data.history.score : 
                    selectedMetric === 'Steps' ? data.history.steps :
                    selectedMetric === 'Heart Rate' ? data.history.heart :
                    selectedMetric.includes('Blood') || selectedMetric === 'BP' ? data.history.bp : 
                    data.history.sleep
                } 
                currentVal={
                    selectedMetric === 'Health Score' ? liveScore : 
                    getGraphValue(selectedMetric)
                } 
                close={() => setSelectedMetric(null)} 
            />}
        </div>
    );
};
        
        // --- MEDICINE TAB (UPDATED: Caretaker can TAKE and EDIT) ---
const MedicineTab = ({ data, refreshData, userRole }) => {
    // 1. Role Logic
    const role = (userRole || 'senior').toLowerCase();
    const isDoctor = role === 'doctor';
    const isCaretaker = role === 'caretaker';
    const isSenior = !isDoctor && !isCaretaker;

    // Logic: Both Senior and Caretaker can mark medicine as taken
    const canTakeMed = isSenior || isCaretaker; 

    // 2. State
    const [isAdding, setIsAdding] = useState(false); // Doctor Modal
    const [editingMed, setEditingMed] = useState(null); // Caretaker Modal
    
    // Doctor Form State
    const [newMed, setNewMed] = useState({
        name: '',
        dose: '', 
        instructions: '', 
        time: '', 
        category: 'Daily Routine'
    });

    // --- HANDLERS ---

    // Doctor: Add New Medicine
    const handleAddMed = () => {
        if (!newMed.name || !newMed.dose) return alert("Please enter Name and Dosage");
        
        const newEntry = {
            id: Date.now(),
            name: newMed.name,
            dose: newMed.dose,
            instructions: newMed.instructions,
            schedule: newMed.time,
            category: newMed.category,
            taken: false,
            stock: 0,
            expiry: 'N/A',
            type: newMed.dose.toLowerCase().includes('ml') ? 'Syrup' : 'Tablet'
        };

        const updatedMeds = [...data.meds, newEntry];
        MockBackend.updateData({ ...data, meds: updatedMeds });
        refreshData();
        setIsAdding(false);
        setNewMed({ name: '', dose: '', instructions: '', time: '', category: 'Daily Routine' });
    };

    // Caretaker: Update Stock
    const handleUpdateStock = (id, newStock, newExpiry) => {
        const updatedMeds = data.meds.map(m => {
            if (m.id === id) {
                return { ...m, stock: parseInt(newStock), expiry: newExpiry };
            }
            return m;
        });
        MockBackend.updateData({ ...data, meds: updatedMeds });
        refreshData();
        setEditingMed(null);
    };

    // Senior & Caretaker: Take Medicine
    const toggleMed = (id) => {
        const newMeds = data.meds.map(m => {
            if (m.id === id) {
                const isTaking = !m.taken;
                const newStock = typeof m.stock === 'number' 
                    ? (isTaking ? m.stock - 1 : m.stock + 1) 
                    : m.stock;
                return { ...m, taken: isTaking, stock: newStock };
            }
            return m;
        });
        MockBackend.updateData({ ...data, meds: newMeds });
        refreshData();
    };

    const dailyMeds = data.meds.filter(m => m.category === 'Daily Routine').sort((a, b) => a.taken - b.taken);
    const sosMeds = data.meds.filter(m => m.category === 'As Needed').sort((a, b) => a.taken - b.taken);

    // --- SINGLE CARD COMPONENT ---
    const MedCard = ({ m, type }) => (
        <div 
            key={m.id} 
            // Caretaker Click body to Edit (Inventory)
            onClick={() => isCaretaker && setEditingMed(m)}
            className={`flex flex-col md:flex-row justify-between items-start md:items-center p-4 border rounded-2xl transition-all gap-4 bg-white shadow-sm
                ${isCaretaker ? 'cursor-pointer hover:border-blue-400 hover:shadow-md' : 'hover:border-amber-200'}
            `}
        >
            <div className="flex items-start gap-4 flex-1 min-w-0">
                <div className={`p-3 rounded-full shrink-0 ${m.taken ? 'bg-slate-100 text-slate-400' : (type === 'sos' ? 'bg-red-50 text-red-600' : 'bg-amber-50 text-amber-600')}`}>
                    <i className={`ph-fill ${m.type === 'Syrup' ? 'ph-drop' : 'ph-pill'} text-xl`}></i>
                </div>
                <div className="flex flex-col gap-1 w-full">
                    <h4 className={`font-bold text-lg truncate ${m.taken ? 'line-through text-slate-400' : 'text-slate-800'}`}>
                        {m.name}
                    </h4>
                    <div className="flex flex-wrap gap-2 text-xs text-slate-500 mt-1 items-center">
                        <span className="bg-slate-100 px-2 py-0.5 rounded font-medium">{m.dose}</span>
                        {m.schedule && <span className="bg-slate-100 px-2 py-0.5 rounded font-medium">{m.schedule}</span>}
                        
                        <span className={`${type === 'sos' ? 'bg-red-50 text-red-600' : 'bg-blue-50 text-blue-600'} px-2 py-0.5 rounded font-bold`}>
                            {m.instructions || (type === 'sos' ? 'Emergency' : 'Routine')}
                        </span>
                        
                        {(typeof m.stock === 'number' || m.stock === 0) && (
                            <span className={`px-2 py-0.5 rounded text-[10px] font-bold ${m.stock < 5 ? 'bg-red-100 text-red-600 animate-pulse' : 'bg-green-100 text-green-700'}`}>
                                Stock: {m.stock}
                            </span>
                        )}
                        {m.expiry && (
                            <span className="text-slate-400 text-[10px] font-bold bg-slate-50 border border-slate-100 px-2 py-0.5 rounded">
                                Exp: {m.expiry}
                            </span>
                        )}
                        {isCaretaker && <span className="text-[10px] text-blue-500 font-bold bg-blue-50 px-2 py-0.5 rounded"><i className="ph-bold ph-pencil-simple"></i> Edit Stock</span>}
                    </div>
                </div>
            </div>
            
            {/* BUTTON: VISIBLE FOR SENIOR AND CARETAKER */}
            {canTakeMed && (
                <button 
                    onClick={(e) => { e.stopPropagation(); toggleMed(m.id); }} 
                    className={`w-full md:w-auto px-8 py-3 md:py-2 rounded-xl font-bold text-sm transition-all active:scale-95 shadow-sm 
                    ${m.taken 
                        ? 'bg-slate-100 text-slate-400 cursor-default' 
                        : (type === 'sos' 
                            ? 'bg-white border-2 border-red-500 text-red-600 hover:bg-red-50' 
                            : 'bg-amber-500 text-white hover:bg-amber-600 shadow-amber-200'
                        )
                    }`}
                >
                    {m.taken ? (
                        <span className="flex items-center justify-center gap-2"><i className="ph-bold ph-check-circle"></i> Taken</span>
                    ) : (
                        type === 'sos' ? 'Record Use' : 'Take Now'
                    )}
                </button>
            )}
        </div>
    );

    return (
        <div className="p-4 md:p-8 space-y-8 fade-in pb-32 max-w-4xl mx-auto relative">
            
            {/* Header Area */}
            <div className="flex justify-between items-center">
                <div className="flex items-center gap-3">
                    <div className="p-3 bg-amber-100 text-amber-600 rounded-2xl">
                        <i className="ph-fill ph-prescription text-2xl"></i>
                    </div>
                    <div>
                        <h1 className="text-2xl font-bold text-slate-800">Medicine Cabinet</h1>
                        {isDoctor && <p className="text-xs text-blue-600 font-bold">Doctor Mode: Add Prescriptions</p>}
                        {isCaretaker && <p className="text-xs text-green-600 font-bold">Caretaker Mode: Manage & Assist</p>}
                    </div>
                </div>
                
                {/* DOCTOR: Add Prescription Button */}
                {isDoctor && (
                    <button 
                        onClick={() => setIsAdding(true)}
                        className="bg-blue-600 text-white px-4 py-2 rounded-xl font-bold shadow-md hover:bg-blue-700 flex items-center gap-2"
                    >
                        <i className="ph-bold ph-plus"></i> Add Rx
                    </button>
                )}
            </div>
            
            {/* Daily Routine Section */}
            <section className="space-y-4">
                <h3 className="font-bold text-lg text-slate-600 px-1 flex items-center gap-2">
                    <i className="ph-fill ph-sun-horizon text-amber-500"></i> Daily Schedule
                </h3>
                <div className="grid gap-4">
                    {dailyMeds.length > 0 ? (
                        dailyMeds.map(m => <MedCard m={m} type="daily" key={m.id} />)
                    ) : (
                        <p className="text-slate-400 italic p-4 text-center">No daily medicines scheduled.</p>
                    )}
                </div>
            </section>

            {/* SOS Section */}
            <section className="space-y-4 pt-4">
                <h3 className="font-bold text-lg text-slate-600 px-1 flex items-center gap-2">
                    <i className="ph-fill ph-first-aid text-red-500"></i> As Needed / SOS
                </h3>
                <div className="grid gap-4">
                    {sosMeds.length > 0 ? (
                        sosMeds.map(m => <MedCard m={m} type="sos" key={m.id} />)
                    ) : (
                        <p className="text-slate-400 italic p-4 text-center">No emergency medicines listed.</p>
                    )}
                </div>
            </section>

            {/* --- DOCTOR MODAL: ADD PRESCRIPTION --- */}
            {isAdding && (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl w-full max-w-md p-6 space-y-4 shadow-2xl">
                        <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                            <i className="ph-bold ph-prescription text-blue-600"></i> Add Prescription
                        </h3>
                        
                        <div className="space-y-3">
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase">Medicine Name</label>
                                <input 
                                    className="w-full border rounded-lg p-2 font-bold text-slate-700 bg-slate-50"
                                    placeholder="e.g. Metformin"
                                    value={newMed.name}
                                    onChange={e => setNewMed({...newMed, name: e.target.value})}
                                />
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="text-xs font-bold text-slate-500 uppercase">Dosage</label>
                                    <input 
                                        className="w-full border rounded-lg p-2 bg-slate-50"
                                        placeholder="e.g. 500mg / 1 Tab"
                                        value={newMed.dose}
                                        onChange={e => setNewMed({...newMed, dose: e.target.value})}
                                    />
                                </div>
                                <div>
                                    <label className="text-xs font-bold text-slate-500 uppercase">Timing</label>
                                    <select 
                                        className="w-full border rounded-lg p-2 bg-slate-50"
                                        value={newMed.time}
                                        onChange={e => setNewMed({...newMed, time: e.target.value})}
                                    >
                                        <option value="">Select Time</option>
                                        <option value="Before Breakfast">Before Breakfast</option>
                                        <option value="After Breakfast">After Breakfast</option>
                                        <option value="Before Lunch">Before Lunch</option>
                                        <option value="After Lunch">After Lunch</option>
                                        <option value="Before Dinner">Before Dinner</option>
                                        <option value="After Dinner">After Dinner</option>
                                        <option value="Bedtime">Bedtime</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase">Instructions</label>
                                <input 
                                    className="w-full border rounded-lg p-2 bg-slate-50"
                                    placeholder="e.g. Take with warm water"
                                    value={newMed.instructions}
                                    onChange={e => setNewMed({...newMed, instructions: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase">Category</label>
                                <div className="flex gap-2 mt-1">
                                    <button 
                                        onClick={() => setNewMed({...newMed, category: 'Daily Routine'})}
                                        className={`flex-1 py-2 rounded-lg font-bold text-sm ${newMed.category === 'Daily Routine' ? 'bg-amber-500 text-white' : 'bg-slate-100 text-slate-500'}`}
                                    >Daily</button>
                                    <button 
                                        onClick={() => setNewMed({...newMed, category: 'As Needed'})}
                                        className={`flex-1 py-2 rounded-lg font-bold text-sm ${newMed.category === 'As Needed' ? 'bg-red-500 text-white' : 'bg-slate-100 text-slate-500'}`}
                                    >SOS / Needed</button>
                                </div>
                            </div>
                        </div>

                        <div className="flex gap-3 pt-2">
                            <button onClick={() => setIsAdding(false)} className="flex-1 py-3 rounded-xl font-bold text-slate-500 bg-slate-100 hover:bg-slate-200">Cancel</button>
                            <button onClick={handleAddMed} className="flex-1 py-3 rounded-xl font-bold text-white bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-200">Save Prescription</button>
                        </div>
                    </div>
                </div>
            )}

            {/* --- CARETAKER MODAL: EDIT STOCK --- */}
            {editingMed && (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl w-full max-w-sm p-6 space-y-4 shadow-2xl">
                        <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                            <i className="ph-bold ph-package text-green-600"></i> Manage Inventory
                        </h3>
                        <p className="text-sm text-slate-500 font-medium">Updating: <span className="text-slate-800 font-bold">{editingMed.name}</span></p>
                        
                        <div className="space-y-3">
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase">Current Stock</label>
                                <input 
                                    type="number"
                                    className="w-full border rounded-lg p-3 font-bold text-slate-700 bg-slate-50"
                                    defaultValue={editingMed.stock}
                                    id="edit-stock"
                                />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-500 uppercase">Expiry Date</label>
                                <input 
                                    type="text"
                                    className="w-full border rounded-lg p-3 font-bold text-slate-700 bg-slate-50"
                                    defaultValue={editingMed.expiry}
                                    placeholder="e.g. Dec 2025"
                                    id="edit-expiry"
                                />
                            </div>
                        </div>

                        <div className="flex gap-3 pt-2">
                            <button onClick={() => setEditingMed(null)} className="flex-1 py-3 rounded-xl font-bold text-slate-500 bg-slate-100 hover:bg-slate-200">Cancel</button>
                            <button 
                                onClick={() => handleUpdateStock(
                                    editingMed.id, 
                                    document.getElementById('edit-stock').value, 
                                    document.getElementById('edit-expiry').value
                                )} 
                                className="flex-1 py-3 rounded-xl font-bold text-white bg-green-600 hover:bg-green-700 shadow-lg shadow-green-200"
                            >
                                Update
                            </button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};
   // --- COMPLETE WELLNESS, NUTRITION & HYDRATION TAB ---
const WellnessTab = ({ data, refreshData, userRole = 'caretaker' }) => {
    // 1. NORMALIZE ROLE
    const currentRole = (userRole || 'caretaker').toLowerCase();

    // 2. DOCTOR BLOCKER
    if (currentRole === 'doctor') {
        return null; 
    }

    // --- State ---
    const [activeMeal, setActiveMeal] = useState('Breakfast');
    const [waterGlasses, setWaterGlasses] = useState(2);
    const [isEditing, setIsEditing] = useState(false);
    const [yogaVerified, setYogaVerified] = useState(false); // New state for caretaker verification
    
    const getTodayString = () => new Date().toDateString();

    const emptyDietPlan = {
        Breakfast: { items: "", cal: "0", protein: "0g", fiber: "0g", tip: "" },
        Lunch: { items: "", cal: "0", protein: "0g", fiber: "0g", tip: "" },
        Snack: { items: "", cal: "0", protein: "0g", fiber: "0g", tip: "" },
        Dinner: { items: "", cal: "0", protein: "0g", fiber: "0g", tip: "" },
    };

    const initialData = {
        Breakfast: { items: "Oats with almonds / Veg Idli", cal: "310", protein: "12g", fiber: "8g", tip: "Take with warm water" },
        Lunch: { items: "2 Multigrain Roti, Dal, Spinach, Curd", cal: "460", protein: "18g", fiber: "10g", tip: "Chew slowly for digestion" },
        Snack: { items: "Makhana / Walnuts & Green Tea", cal: "120", protein: "4g", fiber: "3g", tip: "Avoid sugary tea" },
        Dinner: { items: "Moong Dal Khichdi / Papaya Salad", cal: "340", protein: "10g", fiber: "6g", tip: "Eat 2 hours before bed" },
    };

    const [dietPlans, setDietPlans] = useState(initialData);
    const [lastUpdated, setLastUpdated] = useState(getTodayString());

    useEffect(() => {
        const today = getTodayString();
        if (lastUpdated !== today) {
            setDietPlans(emptyDietPlan);
            setYogaVerified(false); // Reset yoga status on new day
        }
    }, []);

    const totalCalories = Object.values(dietPlans).reduce((acc, meal) => {
        const val = parseInt(meal.cal.replace(/[^0-9]/g, '')) || 0;
        return acc + val;
    }, 0);

    const maxCalories = 1800;
    const caloriePercentage = Math.min((totalCalories / maxCalories) * 100, 100);

    const handleDietChange = (field, value) => {
        setDietPlans(prev => ({
            ...prev,
            [activeMeal]: {
                ...prev[activeMeal],
                [field]: value
            }
        }));
    };

    const saveDiet = () => {
        setIsEditing(false);
        setLastUpdated(getTodayString());
        alert("Diet Plan Updated!");
    };

    const handleCaretakerYogaClick = () => {
        // Open the link
        window.open("https://www.youtube.com/@SubhashYogakro/streams", "_blank");
        // Update UI to show "Done"
        setYogaVerified(true);
    };

    const isPlanPending = lastUpdated !== getTodayString();

    const yogaPoses = [
        { id: 1, name: "Knee Pain Relief", time: "Short", benefit: "Joint Care", icon: "ph-shield-check", color: "bg-blue-50 text-blue-600", link: "https://www.youtube.com/watch?v=FJjvKz0kD7E" },
        { id: 2, name: "Back Pain Asanas", time: "1 min", benefit: "Spine", icon: "ph-backspace", color: "bg-purple-50 text-purple-600", link: "https://www.youtube.com/watch?v=phuS5VLQy8c" },
        { id: 3, name: "Belly Fat Burn", time: "60 min", benefit: "Weight Loss", icon: "ph-fire", color: "bg-orange-50 text-orange-600", link: "https://www.youtube.com/watch?v=ml6cT4AZdqI" },
        { id: 4, name: "Stress Relief Yoga", time: "60 min", benefit: "Mental Calm", icon: "ph-brain", color: "bg-emerald-50 text-emerald-600", link: "https://www.youtube.com/watch?v=v7AYKMP6rOE" },
    ];

    return (
        <div className="p-4 md:p-8 space-y-10 fade-in pb-32 max-w-7xl mx-auto">
            
            {/* Main Title */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div className="flex items-center gap-4">
                    <div className="w-14 h-14 rounded-2xl bg-teal-100 flex items-center justify-center text-teal-600 shadow-sm">
                        <i className="ph-fill ph-leaf text-3xl"></i>
                    </div>
                    <div>
                        <h1 className="text-3xl font-extrabold text-slate-800 tracking-tight">Wellness & Nutrition</h1>
                        <p className="text-slate-500 font-medium italic">Empowering health through movement and balance.</p>
                    </div>
                </div>
            </div>

            {/* --- 1. HERO SECTION: CONDITIONAL RENDER --- */}
            
            {currentRole === 'caretaker' ? (
                // --- A. CARETAKER VIEW: MONITORING CARD ---
                <div className="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-slate-200/50 border border-indigo-50 relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-6 opacity-5">
                        <i className="ph-fill ph-person-simple-tai-chi text-9xl text-indigo-900"></i>
                    </div>
                    
                    <div className="relative z-10 flex flex-col md:flex-row items-center justify-between gap-8">
                        <div>
                            <div className="inline-flex items-center gap-2 bg-indigo-50 text-indigo-700 px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest mb-4">
                                <i className="ph-bold ph-eye"></i> Caretaker Monitor
                            </div>
                            <h2 className="text-3xl font-bold text-slate-800 mb-2">Daily Yoga Session</h2>
                            <p className="text-slate-500 max-w-lg">
                                Ensure the senior attends the live yoga session. Click the button below to open the class and mark it as completed for today.
                            </p>
                        </div>

                        <div className="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col items-center gap-4 min-w-[280px] text-center">
                            {yogaVerified ? (
                                <>
                                    <div className="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-3xl shadow-sm animate-bounce-short">
                                        <i className="ph-fill ph-check"></i>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-lg text-green-700">Session Verified</h3>
                                        <p className="text-xs text-green-600 font-medium">Recorded just now</p>
                                    </div>
                                    <button 
                                        onClick={handleCaretakerYogaClick}
                                        className="text-xs text-slate-400 hover:text-slate-600 underline"
                                    >
                                        Open Link Again
                                    </button>
                                </>
                            ) : (
                                <>
                                    <div className="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center text-3xl shadow-sm">
                                        <i className="ph-fill ph-play"></i>
                                    </div>
                                    <div>
                                        <h3 className="font-bold text-lg text-slate-700">Pending Today</h3>
                                        <p className="text-xs text-slate-400 font-medium">Not verified yet</p>
                                    </div>
                                    <button 
                                        onClick={handleCaretakerYogaClick}
                                        className="w-full bg-indigo-600 text-white py-3 px-6 rounded-xl font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all active:scale-95 flex items-center justify-center gap-2"
                                    >
                                        Open Live Class <i className="ph-bold ph-arrow-right"></i>
                                    </button>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            ) : (
                // --- B. SENIOR VIEW: ORIGINAL HERO CARD ---
                <div className="relative group overflow-hidden rounded-[2.5rem] bg-gradient-to-br from-indigo-600 via-blue-700 to-teal-600 p-8 md:p-12 text-white shadow-2xl">
                    <div className="absolute top-0 right-0 p-8 opacity-10">
                        <i className="ph-fill ph-youtube-logo text-[12rem]"></i>
                    </div>
                    
                    <div className="relative z-10 grid md:grid-cols-2 items-center gap-8">
                        <div className="space-y-6">
                            <div className="inline-flex items-center gap-2 bg-white/20 backdrop-blur-md px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest border border-white/30">
                                <span className="w-2 h-2 bg-red-500 rounded-full animate-ping"></span> Live Daily Yoga
                            </div>
                            <h2 className="text-4xl md:text-5xl font-extrabold leading-tight">Subhash Yogakro <br/> Live Classes</h2>
                            <p className="text-blue-50 opacity-90 text-lg max-w-md">Join thousands in 100% Lifetime Free Yoga sessions. Learn authentic yoga for holistic health.</p>
                            
                            <div className="flex flex-wrap gap-4">
                                <a 
                                    href="https://www.youtube.com/@SubhashYogakro/streams" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="bg-white text-indigo-700 px-8 py-4 rounded-2xl font-bold shadow-xl hover:bg-blue-50 transition-all hover:scale-105 flex items-center gap-3"
                                >
                                    <i className="ph-fill ph-broadcast text-2xl"></i> Join Live Now
                                </a>
                                <a 
                                    href="https://www.youtube.com/@SubhashYogakro" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="bg-indigo-800/40 backdrop-blur-md border border-white/30 text-white px-6 py-4 rounded-2xl font-bold hover:bg-indigo-800/60 transition flex items-center gap-2"
                                >
                                    <i className="ph-fill ph-users-three"></i> 81K+ Community
                                </a>
                            </div>
                        </div>
                        
                        {/* Schedule Highlight */}
                        <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-6 border border-white/20 space-y-4">
                            <h4 className="font-bold flex items-center gap-2"><i className="ph-bold ph-calendar"></i> Daily Timetable</h4>
                            <div className="space-y-3">
                                <div className="flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/10">
                                    <span className="text-sm font-medium">Early Morning</span>
                                    <span className="font-bold text-teal-300">4:30 AM & 5:30 AM</span>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/10">
                                    <span className="text-sm font-medium">Morning Batch</span>
                                    <span className="font-bold text-teal-300">6:30 AM & 7:30 AM</span>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/10">
                                    <span className="text-sm font-medium">Evening Batch</span>
                                    <span className="font-bold text-teal-300">5:00 PM - 7:00 PM</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                {/* 2. NUTRITION & DIET PLANNER (Common for Senior & Caretaker) */}
                <div className="lg:col-span-2 space-y-6">
                    <div className={`bg-white rounded-[2.5rem] p-8 shadow-xl shadow-slate-200/50 border ${isEditing ? 'border-orange-400 ring-4 ring-orange-50' : 'border-slate-50'} h-full flex flex-col transition-all`}>
                        
                        <div className="flex flex-col md:flex-row justify-between items-start gap-6 mb-8">
                            <div className="space-y-3">
                                <h3 className="font-bold text-2xl text-slate-800 flex items-center gap-3 shrink-0">
                                    <div className="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center"><i className="ph-fill ph-bowl-food text-orange-600"></i></div>
                                    Nutrition Guide
                                </h3>
                                
                                {currentRole === 'caretaker' && (
                                    <button 
                                        onClick={() => isEditing ? saveDiet() : setIsEditing(true)}
                                        className={`ml-1 px-4 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider flex items-center gap-2 transition-all w-fit ${
                                            isEditing 
                                            ? 'bg-green-500 text-white shadow-lg shadow-green-200 hover:bg-green-600' 
                                            : 'bg-slate-100 text-slate-500 hover:bg-slate-200'
                                        }`}
                                    >
                                        <i className={`ph-bold ${isEditing ? 'ph-check' : 'ph-pencil-simple'}`}></i>
                                        {isEditing ? 'Save Changes' : 'Edit Plan'}
                                    </button>
                                )}
                            </div>
                            
                            <div className="flex gap-1 bg-slate-50 p-1.5 rounded-xl overflow-x-auto max-w-full no-scrollbar self-start md:self-center">
                                {Object.keys(dietPlans).map(meal => (
                                    <button 
                                        key={meal}
                                        onClick={() => setActiveMeal(meal)}
                                        className={`px-4 py-2 rounded-lg text-sm font-bold transition-all whitespace-nowrap ${activeMeal === meal ? 'bg-white text-orange-600 shadow-sm' : 'text-slate-500 hover:text-slate-800'}`}
                                    >
                                        {meal}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-8 items-center flex-1">
                            <div className="space-y-6">
                                <div className="p-6 rounded-[2rem] bg-orange-50/50 border border-orange-100/50 min-h-[160px] flex flex-col justify-center">
                                    <label className="text-xs font-bold text-orange-400 uppercase tracking-wider mb-2 block">
                                        {activeMeal} Items
                                    </label>
                                    
                                    {isEditing ? (
                                        <textarea 
                                            value={dietPlans[activeMeal].items}
                                            onChange={(e) => handleDietChange('items', e.target.value)}
                                            className="w-full bg-white border border-orange-200 rounded-xl p-3 font-bold text-orange-900 focus:outline-none focus:ring-2 focus:ring-orange-400 placeholder:font-normal text-lg"
                                            rows="2"
                                            placeholder={`Enter items for ${activeMeal}...`}
                                        />
                                    ) : (
                                        <p className={`font-bold text-xl mb-3 ${isPlanPending && !dietPlans[activeMeal].items ? 'text-slate-400 italic' : 'text-orange-900'}`}>
                                            {(isPlanPending && !dietPlans[activeMeal].items) ? "Update pending for today..." : dietPlans[activeMeal].items}
                                        </p>
                                    )}

                                    <div className="flex items-center gap-2 text-orange-600/70 mt-auto pt-2">
                                        <i className="ph-bold ph-info"></i>
                                        {isEditing ? (
                                                <input 
                                                value={dietPlans[activeMeal].tip}
                                                onChange={(e) => handleDietChange('tip', e.target.value)}
                                                className="flex-1 bg-white border border-orange-200 rounded-lg px-2 py-1 text-sm italic font-medium focus:outline-none focus:ring-2 focus:ring-orange-400"
                                                placeholder="Add a health tip..."
                                            />
                                        ) : (
                                            <p className="text-sm italic font-medium">
                                                {(isPlanPending && !dietPlans[activeMeal].tip) ? "No tips added yet." : dietPlans[activeMeal].tip}
                                            </p>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-3 gap-4">
                                    {[
                                        { label: 'Energy', key: 'cal', unit: 'kcal' },
                                        { label: 'Protein', key: 'protein', unit: '' },
                                        { label: 'Fiber', key: 'fiber', unit: '' }
                                    ].map((stat) => (
                                        <div key={stat.key} className="text-center p-3 rounded-2xl bg-slate-50 border border-slate-100">
                                            <span className="block text-xs font-bold text-slate-400 uppercase tracking-tighter">{stat.label}</span>
                                            {isEditing ? (
                                                <div className="flex items-center justify-center gap-1 mt-1">
                                                    <input 
                                                        value={dietPlans[activeMeal][stat.key].replace(stat.unit, '').trim()}
                                                        onChange={(e) => handleDietChange(stat.key, e.target.value + (stat.unit ? ' ' + stat.unit : ''))}
                                                        className="w-full bg-white border border-slate-200 rounded-lg text-center font-bold text-slate-700 focus:outline-none focus:ring-1 focus:ring-orange-400"
                                                        type="text"
                                                        placeholder="0"
                                                    />
                                                </div>
                                            ) : (
                                                <span className="text-lg font-bold text-slate-700">
                                                    {(isPlanPending && (dietPlans[activeMeal][stat.key] === "0" || dietPlans[activeMeal][stat.key] === "0 kcal")) 
                                                        ? "-" 
                                                        : dietPlans[activeMeal][stat.key]}
                                                    {stat.key === 'cal' && !dietPlans[activeMeal][stat.key].includes('kcal') && !isPlanPending ? 'kcal' : ''}
                                                </span>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="bg-slate-50 rounded-[2rem] p-6 h-full flex flex-col justify-center border border-slate-100">
                                <div className="relative pt-1">
                                    <div className="flex mb-2 items-center justify-between">
                                        <div className="text-xs font-bold inline-block text-orange-600 uppercase tracking-widest">Day Calories</div>
                                        <div className="text-right">
                                            <span className={`text-xs font-bold inline-block ${totalCalories > maxCalories ? 'text-red-500' : 'text-orange-600'}`}>
                                                {totalCalories} / {maxCalories}
                                            </span>
                                        </div>
                                    </div>
                                    <div className="overflow-hidden h-3 mb-4 text-xs flex rounded-full bg-orange-100">
                                        <div 
                                            style={{ width: `${caloriePercentage}%` }} 
                                            className={`shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center ${totalCalories > maxCalories ? 'bg-red-500' : 'bg-orange-500'} rounded-full transition-all duration-500`}
                                        ></div>
                                    </div>
                                </div>
                                <p className="text-xs text-slate-400 leading-relaxed font-medium">
                                    {totalCalories === 0 
                                        ? "Add meals to calculate energy intake." 
                                        : "Balanced meals support steady energy and digestion."}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                {/* 3. HYDRATION MONITOR (Common) */}
                <div className="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-slate-200/50 border border-slate-50 flex flex-col items-center justify-between text-center space-y-6 min-h-[400px]">
                    <h3 className="font-bold text-xl text-slate-800">Hydration Monitor</h3>
                    <div className="relative py-4">
                        <div className="w-32 h-48 border-4 border-blue-100 rounded-b-3xl rounded-t-lg relative overflow-hidden bg-slate-50 shadow-inner">
                            <div className="absolute bottom-0 w-full bg-blue-400 transition-all duration-700" style={{ height: `${(waterGlasses / 8) * 100}%` }}>
                                <div className="absolute top-0 w-full h-4 bg-blue-300 opacity-50 -translate-y-2 rounded-full animate-pulse"></div>
                            </div>
                            <div className="absolute inset-0 flex items-center justify-center font-black text-3xl text-blue-900/20">{waterGlasses * 250}ml</div>
                        </div>
                    </div>
                    <div className="space-y-4 w-full">
                        <div className="flex justify-center gap-4">
                            <button onClick={() => setWaterGlasses(Math.max(0, waterGlasses - 1))} className="w-12 h-12 rounded-xl bg-slate-100 text-slate-400 hover:bg-blue-50 hover:text-blue-500 transition-all flex items-center justify-center text-2xl font-bold">-</button>
                            <div className="flex-1 flex items-center justify-center font-bold text-slate-700 bg-blue-50/50 rounded-xl">{waterGlasses} / 8 Glasses</div>
                            <button onClick={() => setWaterGlasses(Math.min(12, waterGlasses + 1))} className="w-12 h-12 rounded-xl bg-blue-100 text-blue-600 hover:bg-blue-600 hover:text-white transition-all flex items-center justify-center text-2xl font-bold">+</button>
                        </div>
                        <p className="text-[10px] uppercase font-black text-slate-300 tracking-[0.2em]">Daily Goal: 2 Liters</p>
                    </div>
                </div>
            </div>

            {/* 4. QUICK EXERCISE LIBRARY (Hidden for Caretaker) */}
            {currentRole !== 'caretaker' && (
                <div>
                    <h3 className="text-2xl font-black text-slate-800 flex items-center gap-3 mb-8">
                        <div className="w-10 h-10 bg-teal-100 rounded-xl flex items-center justify-center"><i className="ph-fill ph-person-simple-tai-chi text-teal-600"></i></div>
                        Quick Exercise Library
                    </h3>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        {yogaPoses.map(pose => (
                            <a key={pose.id} href={pose.link} target="_blank" rel="noopener noreferrer" className="group relative bg-white p-6 rounded-[2rem] border border-slate-100 shadow-lg shadow-slate-100/50 transition-all hover:-translate-y-2 hover:shadow-2xl overflow-hidden block">
                                <div className="absolute inset-0 bg-teal-600/90 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition duration-300 z-10 text-white p-6 text-center">
                                    <i className="ph-fill ph-play-circle text-5xl mb-2"></i>
                                    <span className="font-bold text-lg">Watch Guide</span>
                                </div>
                                <div className={`w-14 h-14 ${pose.color} rounded-2xl flex items-center justify-center text-3xl mb-4 transition-transform group-hover:scale-90`}><i className={`ph-fill ${pose.icon}`}></i></div>
                                <h4 className="font-extrabold text-slate-800 text-lg">{pose.name}</h4>
                                <div className="flex flex-wrap gap-2 mt-4">
                                    <span className="text-[10px] font-black uppercase tracking-tighter bg-slate-100 text-slate-500 px-3 py-1 rounded-full flex items-center gap-1"><i className="ph-bold ph-clock"></i> {pose.time}</span>
                                    <span className="text-[10px] font-black uppercase tracking-tighter bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full flex items-center gap-1"><i className="ph-bold ph-sparkles"></i> {pose.benefit}</span>
                                </div>
                            </a>
                        ))}
                    </div>
                </div>
            )}
        </div>
    );
};
// --- COMPLETE USER PROFILE & CONNECTION TAB ---
const ProfileTab = ({ data, refreshData, userRole = 'senior' }) => {
    // 1. NORMALIZE ROLE (Ensures strict comparison)
    const currentRole = (userRole || 'senior').toLowerCase();
    const isSenior = currentRole === 'senior' || currentRole === 'patient';
    const isCaretakerOrDoctor = currentRole === 'caretaker' || currentRole === 'doctor';

    // 2. STATE MANAGEMENT
    const [editMode, setEditMode] = useState(false);
    const [formData, setFormData] = useState(data?.user || { name: "User", age: 65 });
    const [connectIdInput, setConnectIdInput] = useState("");
    const fileInputRef = useRef(null);

    // 3. GENERATE DYNAMIC ID
    const [sushrutaId] = useState(() => {
        const prefix = formData.age >= 60 ? "SNR" : "SH";
        const randomNum = Math.floor(1000 + Math.random() * 9000);
        return `${prefix}-${randomNum}`;
    });

    // 4. VOICE FEEDBACK ENGINE
    const speak = (text) => {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.rate = 1;
            window.speechSynthesis.speak(msg);
        }
    };

    const handleChange = (e, field, sub) => {
        if (sub) {
            const parent = formData[field] || {};
            setFormData({ ...formData, [field]: { ...parent, [sub]: e.target.value } });
        } else {
            setFormData({ ...formData, [field]: e.target.value });
        }
    };

    const saveProfile = () => {
        speak("Saving changes to your secure profile.");
        if (refreshData) refreshData(formData);
        setEditMode(false);
        alert("Profile Updated!");
    };

    const handleConnectionAction = (action) => {
        speak(`You have ${action}ed the connection request.`);
        alert(`Request ${action}ed successfully.`);
    };

    return (
        <div className="p-6 space-y-6 fade-in h-full overflow-y-auto pb-24">
            
            {/* --- HEADER SECTION --- */}
            <div className="flex justify-between items-center">
                <div className="flex items-center gap-4">
                    <div className="w-12 h-12 rounded-xl bg-teal-100 flex items-center justify-center text-teal-600 shadow-sm">
                        <i className="ph-fill ph-user-circle text-2xl"></i>
                    </div>
                    <h1 className="text-2xl font-bold text-slate-800">
                        {isSenior ? "My Profile" : "Senior Profile View"}
                    </h1>
                </div>

                {/* Edit button ONLY for Senior */}
                {isSenior && (
                    <button 
                        onClick={() => { if(editMode) saveProfile(); else { speak("Edit mode active"); setEditMode(true); } }}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold shadow transition hover:bg-blue-700"
                    >
                        {editMode ? 'Save' : 'Edit'}
                    </button>
                )}
            </div>

            <div className="max-w-4xl mx-auto space-y-6">
                
                {/* 1. BASIC DETAILS CARD (Visible to Everyone) */}
                <div className="bg-white p-8 rounded-2xl border shadow-sm border-l-4 border-l-teal-500">
                    <h3 className="font-bold text-teal-800 border-b pb-4 mb-6 flex items-center gap-2 text-lg">
                        <i className="ph-fill ph-identification-card text-2xl"></i> 1. Basic Details
                    </h3>

                    <div className="flex flex-col items-center mb-8">
                        <div className="relative w-32 h-32 mb-4 cursor-pointer" onClick={() => editMode && fileInputRef.current.click()}>
                            <img src={formData.photo || `https://ui-avatars.com/api/?name=${formData.name}`} className="w-full h-full rounded-full object-cover border-4 border-teal-50 shadow-md" />
                            {editMode && (
                                <div className="overlay absolute inset-0 bg-black/40 rounded-full flex items-center justify-center text-white text-2xl">
                                    <i className="ph-bold ph-camera"></i>
                                </div>
                            )}
                            <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={(e) => {
                                const f = e.target.files[0];
                                if(f){ const r=new FileReader(); r.onloadend=()=>setFormData({...formData, photo:r.result}); r.readAsDataURL(f); }
                            }} />
                        </div>
                        
                        <div className="bg-slate-100 px-4 py-1 rounded-lg border border-slate-200 mb-4">
                            <span className="text-xs font-bold text-slate-500 mr-2">Sushruta ID:</span>
                            <span className="font-mono font-bold text-teal-700">{sushrutaId}</span>
                        </div>
                        {!editMode && <h2 className="text-2xl font-bold text-slate-800">{formData.name}</h2>}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label className="form-label">Full Name</label><input disabled={!editMode} value={formData.name} onChange={(e)=>handleChange(e,'name')} className="form-input font-semibold" /></div>
                        <div><label className="form-label">Phone Number</label><input disabled={!editMode} value={formData.phone} onChange={(e)=>handleChange(e,'phone')} className="form-input" /></div>
                        <div><label className="form-label">Date of Birth</label><input type="date" disabled={!editMode} value={formData.dob} onChange={(e)=>handleChange(e,'dob')} className="form-input" /></div>
                        <div><label className="form-label">Language</label><select disabled={!editMode} value={formData.language} onChange={(e)=>handleChange(e,'language')} className="form-input"><option>Hindi</option><option>English</option><option>Marathi</option></select></div>
                        <div className="md:col-span-2"><label className="form-label">Address</label><textarea disabled={!editMode} value={formData.address} onChange={(e)=>handleChange(e,'address')} className="form-input" rows="2"></textarea></div>
                    </div>
                </div>

                {/* --- 2. CARETAKER / DOCTOR BLOCK (Accept/Deny) --- */}
                {isCaretakerOrDoctor && (
                    <div className="bg-indigo-50 p-6 rounded-2xl border-2 border-indigo-200 shadow-md">
                        <h3 className="font-bold text-indigo-900 mb-4 flex items-center gap-2 text-lg">
                            <i className="ph-fill ph-bell-ringing text-indigo-600"></i> Action Required
                        </h3>
                        <div className="bg-white p-5 rounded-xl border border-indigo-100 flex flex-col md:flex-row items-center justify-between gap-4">
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">
                                    {formData.name?.charAt(0)}
                                </div>
                                <div>
                                    <p className="font-bold text-slate-800">Connection Request from {formData.name}</p>
                                    <p className="text-sm text-slate-500 italic">"Allow access to medical history"</p>
                                </div>
                            </div>
                            <div className="flex gap-3">
                                <button onClick={() => handleConnectionAction("Accept")} className="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700">Accept</button>
                                <button onClick={() => handleConnectionAction("Deny")} className="bg-white border border-red-200 text-red-600 px-6 py-2 rounded-lg font-bold hover:bg-red-50">Deny</button>
                            </div>
                        </div>
                    </div>
                )}

                {/* --- 3. SENIOR PRIVATE SECTIONS (Strictly Hidden for Caretaker/Doctor) --- */}
                {isSenior && (
                    <div className="space-y-6">
                        <div className="bg-white p-8 rounded-2xl border shadow-sm border-l-4 border-l-red-500">
                            <h3 className="font-bold text-red-800 border-b pb-4 mb-6 flex items-center gap-2 text-lg"><i className="ph-fill ph-ambulance text-2xl"></i> 2. Emergency Details</h3>
                            <div className="p-5 bg-red-50 rounded-xl border border-red-100 mb-4 text-left">
                                <p className="text-xs font-bold text-red-700 uppercase mb-3">Primary Contact</p>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label className="form-label text-red-700">Name</label><input disabled={!editMode} value={formData.emergencyPrimary?.name || ''} className="form-input border-red-200 bg-white" /></div>
                                    <div><label className="form-label text-red-700">Phone</label><input disabled={!editMode} value={formData.emergencyPrimary?.contact || ''} className="form-input border-red-200 bg-white" /></div>
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                                <div><label className="form-label">Hospital</label><input disabled={!editMode} value={formData.hospitalPref} className="form-input" /></div>
                                <div><label className="form-label text-red-600">Allergies</label><input disabled={!editMode} value={formData.allergies} className="form-input border-red-100 text-red-600 bg-red-50 font-bold" /></div>
                            </div>
                        </div>

                        <div className="bg-white p-8 rounded-2xl border shadow-sm border-l-4 border-l-blue-500 text-left">
                            <h3 className="font-bold text-blue-800 border-b pb-4 mb-6 flex items-center gap-2 text-lg"><i className="ph-fill ph-heartbeat text-2xl"></i> 3. Medical History</h3>
                            <div className="grid gap-6">
                                <div><label className="form-label">Chronic Conditions</label><textarea disabled={!editMode} value={formData.chronicConditions} className="form-input bg-blue-50/50" rows="3"></textarea></div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div><label className="form-label">Recent Surgeries</label><input disabled={!editMode} value={formData.surgeries} className="form-input" /></div>
                                    <div><label className="form-label">Ongoing Treatments</label><input disabled={!editMode} value={formData.treatments} className="form-input" /></div>
                                </div>
                            </div>
                        </div>

                        {/* Connection Tool for Senior */}
                        <div className="bg-slate-900 p-8 rounded-2xl text-white shadow-xl flex flex-col md:flex-row items-center justify-between gap-6">
                            <div className="text-left">
                                <h2 className="text-xl font-bold flex items-center gap-2"><i className="ph-fill ph-user-plus text-blue-400"></i> Add Connection</h2>
                                <p className="text-slate-400 text-sm">Enter ID to share health records.</p>
                            </div>
                            <div className="flex w-full md:w-auto bg-white/10 p-1.5 rounded-xl border border-white/20">
                                <input placeholder="Enter ID" className="bg-transparent px-4 py-2 outline-none flex-1 text-white" value={connectIdInput} onChange={(e) => setConnectIdInput(e.target.value)} />
                                <button onClick={() => { speak(`Request sent to ${connectIdInput}`); alert("Sent!"); setConnectIdInput(""); }} className="bg-blue-600 px-6 py-2 rounded-lg font-bold">Send</button>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
};



        // --- DASHBOARD CONTAINER ---
        const Dashboard = ({ user, onLogout }) => {
            const [tab, setTab] = useState('home');
            const [sideOpen, setSideOpen] = useState(false);
            const [rightOpen, setRightOpen] = useState(false);
            
            // Central Data State
            const [healthData, setHealthData] = useState(MockBackend.getData());
            const refreshData = () => setHealthData(MockBackend.getData());

            useEffect(() => {
                if(user) {
                    MockBackend.saveUser(user);
                    refreshData();
                }
            }, []);

            const addReminder = (text, time, day) => {
                const newReminders = [...healthData.reminders, { id: Date.now(), text, time, day, completed: false }];
                MockBackend.updateData({ ...healthData, reminders: newReminders });
                refreshData();
            };

            const deleteReminder = (id) => {
                const newReminders = healthData.reminders.filter(r => r.id !== id);
                MockBackend.updateData({ ...healthData, reminders: newReminders });
                refreshData();
            };

            return (
                <div className="flex h-screen overflow-hidden bg-slate-50 relative">
                    <Sidebar activeTab={tab} setTab={setTab} onLogout={onLogout} user={healthData.user} isOpen={sideOpen} closeMenu={() => setSideOpen(false)} />

                    <div className="flex-1 flex flex-col h-full w-full relative">
                        {/* Mobile Header */}
                        <header className="md:hidden h-16 bg-white border-b flex items-center justify-between px-4 shrink-0 z-20 relative">
                            <button onClick={() => setSideOpen(true)} className="text-slate-600 p-2"><i className="ph-bold ph-list text-2xl"></i></button>
                            
                            <div className="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center gap-4">
                                <span className="font-bold text-blue-900 flex items-center gap-2">
                                        {/* Circle Wrapper for the Logo */}
                                        <div className="w-9 h-9 rounded-full bg-white border border-slate-100 shadow-sm flex items-center justify-center overflow-hidden shrink-0">
                                            <img 
                                                src="https://image2url.com/images/1766163568484-919924f6-d48d-4888-8754-e489e0c9e000.png"
                                                alt="Sushruta Logo" 
                                                className="w-8 h-8 rounded-full object-contain " 
                                            />
                                        </div>
                                        <span className="tracking-tight">SUSHRUTA</span>
                                    </span>
                                
                                <button onClick={() => setRightOpen(true)} className="hidden md:flex text-slate-600 p-2 relative hover:bg-slate-100 rounded-full">
                                    <i className="ph-bold ph-calendar-blank text-2xl"></i>
                                    <span className="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
                                </button>
                            </div>

                            <button onClick={() => setRightOpen(true)} className="lg:hidden text-slate-600 p-2 relative">
                                <i className="ph-bold ph-calendar-blank text-2xl"></i>
                                <span className="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
                            </button>
                        </header>

                        <main className="flex-1 overflow-y-auto custom-scroll scroll-smooth">
                            {tab === 'home' && <DashboardContent data={healthData} refreshData={refreshData} user={healthData.user} setTab={setTab} />}
                            {tab === 'profile' && <ProfileTab data={healthData} refreshData={refreshData} />}
                            {tab === 'gps' && <GPSModule />}
                            {tab === 'meds' && (
                                <MedicineTab 
                                    data={healthData} 
                                    refreshData={refreshData} 
                                    userRole={user?.role} 
                                />
                            )}
                            {/* --- FIXED LINE: Passing userRole to WellnessTab --- */}
                                {tab === 'wellness' && (
                                    <WellnessTab 
                                        data={healthData} 
                                        refreshData={refreshData} 
                                        userRole={healthData.user?.role} 
                                    />
                                )}
                            {tab === 'assistant' && <AiAssistantTab />}
                            {tab === 'reports' && <ReportsTab data={healthData} />}
                            {tab === 'appointments' && <AppointmentsTab data={healthData} user={user} refreshData={refreshData} />}
                            {tab === 'shop' && <MedicineShopTab />}
                            {tab === 'gov' && <GovernmentSchemesTab />}
                            {tab === 'joy' && (
                                <EmotionalWellnessTab 
                                        data={healthData} 
                                        refreshData={refreshData} 
                                        userRole={user?.role} 
                                    />
                                )}
                            {tab === 'insurance' && <InsuranceTab data={healthData} refreshData={refreshData} />}
                        </main>
                    </div>

                    <RightPanel 
                        reminders={healthData.reminders} 
                        isOpen={rightOpen} 
                        closeMenu={() => setRightOpen(false)}
                        onAddReminder={addReminder} 
                        onDeleteReminder={deleteReminder}
                    />
                </div>
            );
        };

        // --- APP ROOT ---
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            
            useEffect(() => {
                const session = sessionStorage.getItem('activeUser');
                if (session) setCurrentUser(JSON.parse(session));
            }, []);

            const handleLogin = (user) => {
                setCurrentUser(user);
                sessionStorage.setItem('activeUser', JSON.stringify(user));
            };

            const handleLogout = () => {
                setCurrentUser(null);
                sessionStorage.removeItem('activeUser');
            };

            return currentUser ? <Dashboard user={currentUser} onLogout={handleLogout} /> : <Auth onLogin={handleLogin} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>